# ============================================================================
# K8s AIOps Copilot - Kubernetes 集群内配置
# ============================================================================
# 此配置文件用于 Kubernetes 集群内部署
# 所有敏感信息通过环境变量 ${VAR} 注入，无需在此文件中硬编码
# ============================================================================

# 内置工具集配置（Built-in Toolsets）
toolsets:
  # Grafana 仪表盘
  grafana/dashboards:
    enabled: true
    config:
      # 使用环境变量注入（从 Secret 加载）
      api_key: "${GRAFANA_API_KEY}"
      # Kubernetes 内部 DNS 格式: <service>.<namespace>.svc:<port>
      url: "${GRAFANA_URL:-http://observability-grafana.xnet.svc:80}"
  
  # Prometheus 指标查询
  prometheus/metrics:
    enabled: true
    config:
      prometheus_url: "${PROMETHEUS_URL:-http://observability-prometheus.xnet.svc:9090}"
  
  # Docker（集群内通常禁用）
  docker/core:
    enabled: false
  
  # Elasticsearch/OpenSearch 日志查询
  opensearch/logs:
    enabled: true
    config:
      # OpenSearch/Elasticsearch URL
      opensearch_url: "${OPENSEARCH_URL:-https://elasticsearch-external.xnet.svc:9200}"
      index_pattern: "${OPENSEARCH_INDEX_PATTERN:-filebeat-*}"
      # Basic Auth Header: echo -n "username:password" | base64
      opensearch_auth_header: "${OPENSEARCH_AUTH_HEADER}"
      labels:
        pod: "kubernetes.pod.name"
        namespace: "kubernetes.namespace"
        timestamp: "@timestamp"
        message: "message"
  
  # Kubernetes 原生日志（禁用，使用 opensearch/logs）
  kubernetes/logs:
    enabled: false

# MCP 服务器配置（集群内通常禁用，使用 Sidecar 模式或独立部署）
mcp_servers:
  test_tool_server:
    enabled: false
    config:
      url: "http://localhost:8081/sse"
      mode: "sse"
  
  elasticsearch:
    enabled: false
    config:
      url: "http://localhost:8082/sse"
      mode: "sse"

# ============================================================================
# 使用说明
# ============================================================================
# 1. 创建 Secret 存储敏感信息：
#    kubectl create secret generic aiops-secrets \
#      --from-literal=DEEPSEEK_API_KEY=sk-xxx \
#      --from-literal=GRAFANA_API_KEY=glsa_xxx \
#      --from-literal=OPENSEARCH_AUTH_HEADER="Basic xxx"
#
# 2. 部署时通过 envFrom 注入 Secret：
#    envFrom:
#      - secretRef:
#          name: aiops-secrets
#
# 3. 配置文件中的 ${VAR} 会自动替换为环境变量值
# ============================================================================
