# Runbook çŸ¥è¯†åº“ ConfigMap
# åŸºäºé˜¿é‡Œäº‘ Pod å¼‚å¸¸é—®é¢˜æ’æŸ¥æ–‡æ¡£é‡æ„
# å‚è€ƒ: https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1

apiVersion: v1
kind: ConfigMap
metadata:
  name: aiops-runbooks
  namespace: aiops
data:
  catalog.json: |
    {
      "catalog": [
        {
          "_comment": "========== L0: åŸºç¡€è®¾æ–½å±‚ (Infrastructure) ==========",
          "id": "infra-disk-full",
          "type": "knowledge",
          "layer": "L0",
          "update_date": "2026-01-04",
          "description": "ã€L0-çŸ¥è¯†å‹ã€‘ç£ç›˜ç©ºé—´è€—å°½ - No space left on deviceã€æ—¥å¿—è†¨èƒ€ã€Docker é•œåƒå †ç§¯",
          "link": "infra-disk-full.md"
        },
        {
          "id": "infra-memory-exhausted",
          "type": "knowledge",
          "layer": "L0",
          "update_date": "2026-01-04",
          "description": "ã€L0-çŸ¥è¯†å‹ã€‘ç³»ç»Ÿå†…å­˜è€—å°½ - ç³»ç»Ÿ OOMã€è¿›ç¨‹è¢« killedã€å†…å­˜æ³„æ¼æ’æŸ¥",
          "link": "infra-memory-exhausted.md"
        },
        {
          "id": "infra-cpu-saturation",
          "type": "knowledge",
          "layer": "L0",
          "update_date": "2026-01-04",
          "description": "ã€L0-çŸ¥è¯†å‹ã€‘CPU é¥±å’Œ - é«˜ load averageã€è¿›ç¨‹å“åº”æ…¢ã€CPU å¯†é›†å‹è¿›ç¨‹å®šä½",
          "link": "infra-cpu-saturation.md"
        },
        {
          "_comment": "========== L1: é›†ç¾¤ä¸èŠ‚ç‚¹å±‚ (Cluster & Node) ==========",
          "id": "node-not-ready",
          "type": "knowledge",
          "layer": "L1",
          "update_date": "2026-01-04",
          "description": "ã€L1-çŸ¥è¯†å‹ã€‘èŠ‚ç‚¹å¼‚å¸¸ (NotReady) - kubelet é—®é¢˜ã€å®¹å™¨è¿è¡Œæ—¶ã€ç½‘ç»œåˆ†åŒº",
          "link": "node-not-ready.md"
        },
        {
          "id": "node-disk-pressure",
          "type": "knowledge",
          "layer": "L1",
          "update_date": "2026-01-04",
          "description": "ã€L1-çŸ¥è¯†å‹ã€‘èŠ‚ç‚¹ç£ç›˜å‹åŠ› (DiskPressure) - kubelet é©±é€ã€æ¸…ç†ç­–ç•¥",
          "link": "node-disk-pressure.md"
        },
        {
          "id": "node-memory-pressure",
          "type": "knowledge",
          "layer": "L1",
          "update_date": "2026-01-04",
          "description": "ã€L1-çŸ¥è¯†å‹ã€‘èŠ‚ç‚¹å†…å­˜å‹åŠ› (MemoryPressure) - Pod é©±é€ã€OOM åˆ†æ",
          "link": "node-memory-pressure.md"
        },
        {
          "_comment": "========== L2: å·¥ä½œè´Ÿè½½å±‚ (Workload) ==========",
          "id": "pod-quick-diagnosis",
          "type": "procedure",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-æµç¨‹å‹ã€‘Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­å…¥å£ - æ ¹æ® Pod çŠ¶æ€è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„è¯Šæ–­æ‰‹å†Œ",
          "link": "pod-quick-diagnosis.md",
          "operations": ["è¯Šæ–­", "æ’æŸ¥", "æ£€æŸ¥"]
        },
        {
          "id": "pod-pending",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘Pod è°ƒåº¦å¤±è´¥ (Pending) - èŠ‚ç‚¹èµ„æºä¸è¶³ã€äº²å’Œæ€§ã€æ±¡ç‚¹ã€PVC ç­‰é—®é¢˜",
          "link": "pod-pending.md"
        },
        {
          "id": "pod-image-pull-failed",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff/ErrImagePull) - é•œåƒåœ°å€ã€ç½‘ç»œã€è®¤è¯é—®é¢˜",
          "link": "pod-image-pull-failed.md"
        },
        {
          "id": "pod-crashloop-backoff",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff) - Exit Code è§£è¯»ã€OOMã€é…ç½®é”™è¯¯ã€ä¾èµ–é—®é¢˜",
          "link": "pod-crashloop-backoff.md"
        },
        {
          "id": "pod-not-ready",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘Pod æœªå°±ç»ª (Running ä½† 0/1 Ready) - å¥åº·æ£€æŸ¥å¤±è´¥ã€Readiness/Liveness Probe é…ç½®é—®é¢˜",
          "link": "pod-not-ready.md"
        },
        {
          "id": "pod-terminating",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘Pod åˆ é™¤å¡ä½ (Terminating) - Finalizer é˜»å¡ã€èŠ‚ç‚¹ä¸å¯è¾¾ã€å¼ºåˆ¶åˆ é™¤æ–¹æ³•",
          "link": "pod-terminating.md"
        },
        {
          "id": "pod-evicted",
          "type": "knowledge",
          "layer": "L2",
          "update_date": "2025-12-25",
          "description": "ã€L2-çŸ¥è¯†å‹ã€‘Pod è¢«é©±é€ (Evicted) - èŠ‚ç‚¹èµ„æºå‹åŠ›ã€ephemeral-storage è¶…é™",
          "link": "pod-evicted.md"
        },
        {
          "_comment": "========== L3: æœåŠ¡ä¸ç½‘ç»œå±‚ (Service & Network) ==========",
          "id": "service-no-endpoints",
          "type": "knowledge",
          "layer": "L3",
          "update_date": "2026-01-04",
          "description": "ã€L3-çŸ¥è¯†å‹ã€‘Service æ— åç«¯ (Endpoints ä¸ºç©º) - Selector ä¸åŒ¹é…ã€Pod æœªå°±ç»ª",
          "link": "service-no-endpoints.md"
        },
        {
          "id": "dns-resolution-failed",
          "type": "knowledge",
          "layer": "L3",
          "update_date": "2026-01-04",
          "description": "ã€L3-çŸ¥è¯†å‹ã€‘DNS è§£æå¤±è´¥ - CoreDNS å¼‚å¸¸ã€æœåŠ¡åè§£æã€å¤–éƒ¨åŸŸåè§£æ",
          "link": "dns-resolution-failed.md"
        },
        {
          "id": "network-connectivity",
          "type": "knowledge",
          "layer": "L3",
          "update_date": "2026-01-04",
          "description": "ã€L3-çŸ¥è¯†å‹ã€‘ç½‘ç»œè¿é€šæ€§é—®é¢˜ - Pod é—´é€šä¿¡ã€è·¨èŠ‚ç‚¹ç½‘ç»œã€NetworkPolicy é˜»æ–­",
          "link": "network-connectivity.md"
        },
        {
          "id": "ingress-not-working",
          "type": "knowledge",
          "layer": "L3",
          "update_date": "2026-01-04",
          "description": "ã€L3-çŸ¥è¯†å‹ã€‘Ingress æ— æ³•è®¿é—® - 404/502/503 é”™è¯¯ã€è¯ä¹¦é—®é¢˜ã€è·¯ç”±é…ç½®",
          "link": "ingress-not-working.md"
        },
        {
          "_comment": "========== L4: åº”ç”¨å±‚ (Application) ==========",
          "id": "app-connection-refused",
          "type": "knowledge",
          "layer": "L4",
          "update_date": "2026-01-04",
          "description": "ã€L4-çŸ¥è¯†å‹ã€‘åº”ç”¨è¿æ¥è¢«æ‹’ç» - æ•°æ®åº“è¿æ¥å¤±è´¥ã€Redis/MQ è¶…æ—¶ã€ä¾èµ–æœåŠ¡ä¸å¯ç”¨",
          "link": "app-connection-refused.md"
        },
        {
          "id": "app-5xx-errors",
          "type": "knowledge",
          "layer": "L4",
          "update_date": "2026-01-04",
          "description": "ã€L4-çŸ¥è¯†å‹ã€‘åº”ç”¨ 5xx é”™è¯¯ - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ã€Panicã€å¼‚å¸¸å †æ ˆåˆ†æ",
          "link": "app-5xx-errors.md"
        },
        {
          "id": "app-config-errors",
          "type": "knowledge",
          "layer": "L4",
          "update_date": "2026-01-04",
          "description": "ã€L4-çŸ¥è¯†å‹ã€‘åº”ç”¨é…ç½®é”™è¯¯ - ç¯å¢ƒå˜é‡ã€ConfigMap/Secret æŒ‚è½½ã€é…ç½®çƒ­æ›´æ–°",
          "link": "app-config-errors.md"
        },
        {
          "_comment": "========== æ“ä½œæµç¨‹ç±» ==========",
          "id": "helm-observability-install",
          "type": "procedure",
          "layer": "æ“ä½œ",
          "update_date": "2025-12-16",
          "description": "ã€æµç¨‹å‹ã€‘Helm ç®¡ç† Observability å¹³å° - åŒ…å«ï¼šå®‰è£…ã€å‡çº§ã€å¸è½½ä¸‰ä¸ªç‹¬ç«‹æµç¨‹",
          "link": "helm-observability-install.md",
          "operations": ["å®‰è£…", "å‡çº§", "å¸è½½"]
        }
      ]
    }

  # ==========================================================================
  # Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­æµç¨‹ï¼ˆå…¥å£ï¼‰
  # ==========================================================================
  pod-quick-diagnosis.md: |
    # Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­æµç¨‹

    > **ç±»å‹**: `procedure`ï¼ˆæµç¨‹å‹ï¼‰
    > **ç”¨é€”**: Pod å¼‚å¸¸è¯Šæ–­çš„ç»Ÿä¸€å…¥å£ï¼Œæ ¹æ®çŠ¶æ€è·¯ç”±åˆ°å…·ä½“æ‰‹å†Œ
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å¼‚å¸¸é—®é¢˜æ’æŸ¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## Step 1: è·å– Pod çŠ¶æ€

    ```bash
    kubectl get pod <pod-name> -n <namespace> -o wide
    ```

    æˆ–è€…æŸ¥æ‰¾å¼‚å¸¸ Podï¼š
    ```bash
    kubectl get pod -A | grep -v Running | grep -v Completed
    ```

    ## Step 2: æ ¹æ®çŠ¶æ€è·¯ç”±è¯Šæ–­

    | Pod çŠ¶æ€ | è¯´æ˜ | å¯¹åº”æ‰‹å†Œ |
    |---------|------|---------|
    | `Pending` | ç­‰å¾…è°ƒåº¦ | â†’ pod-pending.md |
    | `ImagePullBackOff` / `ErrImagePull` | é•œåƒæ‹‰å–å¤±è´¥ | â†’ pod-image-pull-failed.md |
    | `CrashLoopBackOff` / `Error` | å®¹å™¨å´©æºƒå¾ªç¯ | â†’ pod-crashloop-backoff.md |
    | `Running` (0/1 Ready) | å¥åº·æ£€æŸ¥å¤±è´¥ | â†’ pod-not-ready.md |
    | `Terminating` | åˆ é™¤å¡ä½ | â†’ pod-terminating.md |
    | `Evicted` | è¢«é©±é€ | â†’ pod-evicted.md |
    | `CreateContainerConfigError` | é…ç½®é”™è¯¯ | â†’ æ£€æŸ¥ ConfigMap/Secret |

    ## Step 3: è·å–è¯¦ç»†ä¿¡æ¯

    ```bash
    # æŸ¥çœ‹ Pod è¯¦æƒ…å’Œäº‹ä»¶
    kubectl describe pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹å®¹å™¨æ—¥å¿—
    kubectl logs <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ä¸Šæ¬¡å´©æºƒçš„æ—¥å¿—ï¼ˆå¦‚æœæ˜¯ CrashLoopBackOffï¼‰
    kubectl logs <pod-name> -n <namespace> --previous
    ```

    ## Step 4: æ‰§è¡Œå¯¹åº”æ‰‹å†Œ

    æ ¹æ® Step 2 è¯†åˆ«çš„çŠ¶æ€ï¼Œè°ƒç”¨ `fetch_runbook` è·å–å¯¹åº”æ‰‹å†Œå¹¶æ‰§è¡Œè¯Šæ–­ã€‚

  # ==========================================================================
  # Pod è°ƒåº¦å¤±è´¥ (Pending)
  # ==========================================================================
  pod-pending.md: |
    # Pod è°ƒåº¦å¤±è´¥ (Pending) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod é•¿æ—¶é—´å¤„äº Pending çŠ¶æ€ï¼Œæœªè¢«è°ƒåº¦åˆ°ä»»ä½•èŠ‚ç‚¹
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod è°ƒåº¦é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Pending`ã€`Unschedulable`ã€`FailedScheduling`
    
    **å…¸å‹äº‹ä»¶**:
    - `0/x nodes are available`
    - `Insufficient cpu/memory`
    - `node(s) didn't match node selector`
    - `node(s) had taint that the pod didn't tolerate`
    - `persistentvolumeclaim not found`

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆå…³é”®ï¼ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
    kubectl get nodes -o wide
    kubectl describe nodes | grep -A 5 "Allocated resources"
    
    # æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
    kubectl describe nodes | grep Taints
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: èŠ‚ç‚¹èµ„æºä¸è¶³
    
    **äº‹ä»¶**: `0/x nodes are available: x Insufficient cpu/memory`
    
    **æ ¹å› **: é›†ç¾¤ CPU æˆ–å†…å­˜èµ„æºå·²è€—å°½
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºåˆ†é…
    kubectl describe nodes | grep -A 10 "Allocated resources"
    ```
    
    **ä¿®å¤**:
    - åˆ é™¤ä¸å¿…è¦çš„ Pod é‡Šæ”¾èµ„æº
    - é™ä½ Pod çš„ requests å€¼
    - æ‰©å®¹èŠ‚ç‚¹

    ### åœºæ™¯ 2: èŠ‚ç‚¹é€‰æ‹©å™¨ä¸åŒ¹é…
    
    **äº‹ä»¶**: `node(s) didn't match node selector`
    
    **æ ¹å› **: Pod æŒ‡å®šäº† nodeSelectorï¼Œä½†æ²¡æœ‰èŠ‚ç‚¹å…·æœ‰è¯¥æ ‡ç­¾
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„ nodeSelector
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.nodeSelector}'
    
    # æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾
    kubectl get nodes --show-labels
    ```
    
    **ä¿®å¤**:
    - ä¸ºèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾ï¼š`kubectl label node <node> <key>=<value>`
    - æˆ–ä¿®æ”¹ Pod çš„ nodeSelector

    ### åœºæ™¯ 3: èŠ‚ç‚¹æ±¡ç‚¹ï¼ˆTaintï¼‰é—®é¢˜
    
    **äº‹ä»¶**: `node(s) had taint that the pod didn't tolerate`
    
    **æ ¹å› **: èŠ‚ç‚¹è®¾ç½®äº†æ±¡ç‚¹ï¼Œä½† Pod æ²¡æœ‰å¯¹åº”çš„å®¹å¿
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
    kubectl describe nodes | grep Taints
    ```
    
    **ä¿®å¤**:
    - ä¸º Pod æ·»åŠ  toleration
    - æˆ–ç§»é™¤èŠ‚ç‚¹æ±¡ç‚¹ï¼š`kubectl taint nodes <node> <key>-`

    ### åœºæ™¯ 4: PVC æœªç»‘å®š
    
    **äº‹ä»¶**: `persistentvolumeclaim "xxx" not found` æˆ– `unbound PersistentVolumeClaim`
    
    **æ ¹å› **: Pod å¼•ç”¨çš„ PVC ä¸å­˜åœ¨æˆ–æœªç»‘å®š
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ PVC çŠ¶æ€
    kubectl get pvc -n <namespace>
    kubectl describe pvc <pvc-name> -n <namespace>
    ```
    
    **ä¿®å¤**:
    - åˆ›å»ºå¯¹åº”çš„ PVC
    - æˆ–æ£€æŸ¥ StorageClass æ˜¯å¦æ­£ç¡®

    ### åœºæ™¯ 5: èŠ‚ç‚¹å¤„äº NotReady çŠ¶æ€
    
    **äº‹ä»¶**: `no nodes available to schedule pods`
    
    **æ ¹å› **: æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤„äºä¸å¯ç”¨çŠ¶æ€
    
    **è¯Šæ–­**:
    ```bash
    kubectl get nodes
    kubectl describe node <node-name>
    ```
    
    **ä¿®å¤**: æ¢å¤èŠ‚ç‚¹çŠ¶æ€ï¼ˆæ£€æŸ¥ kubeletã€ç½‘ç»œç­‰ï¼‰

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod è°ƒåº¦å¤±è´¥çš„å…·ä½“åŸå› 
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    
    # å¦‚æœæ˜¯èµ„æºä¸è¶³ï¼ŒæŸ¥çœ‹å¯é‡Šæ”¾çš„èµ„æº
    kubectl get pod -A --sort-by='.status.startTime' | head -20
    
    # å¼ºåˆ¶é‡æ–°è°ƒåº¦ï¼ˆåˆ é™¤åè‡ªåŠ¨é‡å»ºï¼‰
    kubectl delete pod <pod-name> -n <namespace>
    ```

  # ==========================================================================
  # é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff)
  # ==========================================================================
  pod-image-pull-failed.md: |
    # é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº ImagePullBackOff æˆ– ErrImagePull çŠ¶æ€
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘é•œåƒæ‹‰å–é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `ImagePullBackOff`ã€`ErrImagePull`ã€`ImageInspectError`
    
    **å…¸å‹äº‹ä»¶**:
    - `Failed to pull image`
    - `unauthorized: authentication required`
    - `manifest unknown`
    - `connection refused` / `timeout`

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆè·å–å…·ä½“é”™è¯¯ä¿¡æ¯ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Events
    
    # æŸ¥çœ‹ Pod ä½¿ç”¨çš„é•œåƒ
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].image}'
    
    # æŸ¥çœ‹ imagePullSecrets é…ç½®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.imagePullSecrets}'
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: é•œåƒåœ°å€é”™è¯¯
    
    **äº‹ä»¶**: `manifest unknown`ã€`not found`
    
    **æ ¹å› **: é•œåƒåç§°æˆ–æ ‡ç­¾ï¼ˆtagï¼‰ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥é•œåƒåœ°å€æ˜¯å¦æ­£ç¡®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].image}'
    ```
    
    **ä¿®å¤**:
    - ç¡®è®¤é•œåƒåç§°å’Œæ ‡ç­¾æ‹¼å†™æ­£ç¡®
    - ç¡®è®¤é•œåƒå·²æ¨é€åˆ°ä»“åº“
    - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ registry åœ°å€

    ### åœºæ™¯ 2: è®¤è¯å¤±è´¥ï¼ˆç§æœ‰ä»“åº“ï¼‰
    
    **äº‹ä»¶**: `unauthorized: authentication required`ã€`no basic auth credentials`
    
    **æ ¹å› **: ç§æœ‰é•œåƒä»“åº“éœ€è¦è®¤è¯ï¼Œä½†æœªé…ç½®æˆ–é…ç½®é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥ imagePullSecrets
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.imagePullSecrets}'
    
    # æ£€æŸ¥ Secret æ˜¯å¦å­˜åœ¨
    kubectl get secret -n <namespace>
    ```
    
    **ä¿®å¤**:
    ```bash
    # åˆ›å»º docker-registry ç±»å‹çš„ Secret
    kubectl create secret docker-registry <secret-name> \
      --docker-server=<registry-url> \
      --docker-username=<username> \
      --docker-password=<password> \
      -n <namespace>
    
    # åœ¨ Pod/Deployment ä¸­å¼•ç”¨
    # spec.imagePullSecrets:
    #   - name: <secret-name>
    ```

    ### åœºæ™¯ 3: ç½‘ç»œä¸é€š
    
    **äº‹ä»¶**: `connection refused`ã€`timeout`ã€`dial tcp: lookup xxx: no such host`
    
    **æ ¹å› **: èŠ‚ç‚¹æ— æ³•è®¿é—®é•œåƒä»“åº“
    
    **è¯Šæ–­**:
    ```bash
    # åœ¨èŠ‚ç‚¹ä¸Šæµ‹è¯•ç½‘ç»œè¿é€šæ€§
    kubectl run test-network --image=busybox --rm -it -- wget -O- <registry-url>
    
    # æ£€æŸ¥ DNS è§£æ
    kubectl run test-dns --image=busybox --rm -it -- nslookup <registry-host>
    ```
    
    **ä¿®å¤**:
    - æ£€æŸ¥ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰
    - æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
    - æ£€æŸ¥ DNS é…ç½®

    ### åœºæ™¯ 4: é•œåƒæ‹‰å–é€Ÿåº¦æ…¢
    
    **äº‹ä»¶**: é•¿æ—¶é—´å¤„äº `Pulling` çŠ¶æ€
    
    **æ ¹å› **: é•œåƒè¿‡å¤§æˆ–ç½‘ç»œå¸¦å®½ä¸è¶³
    
    **ä¿®å¤**:
    - ä½¿ç”¨é•œåƒåŠ é€Ÿå™¨
    - ä¼˜åŒ–é•œåƒå¤§å°ï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
    - é¢„æ‹‰å–é•œåƒåˆ°èŠ‚ç‚¹

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æ‰‹åŠ¨åœ¨èŠ‚ç‚¹ä¸Šæ‹‰å–é•œåƒæµ‹è¯•
    crictl pull <image-url>
    
    # åˆ é™¤ Pod è§¦å‘é‡è¯•
    kubectl delete pod <pod-name> -n <namespace>
    
    # æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨ï¼ˆä½¿ç”¨ curlï¼‰
    curl -v https://<registry>/v2/<image>/manifests/<tag>
    ```

  # ==========================================================================
  # å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff)
  # ==========================================================================
  pod-crashloop-backoff.md: |
    # å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº CrashLoopBackOff æˆ– Error çŠ¶æ€ï¼ŒRestart Count æŒç»­å¢åŠ 
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å¯åŠ¨å¤±è´¥æ’æŸ¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `CrashLoopBackOff`ã€`Error`ã€`Restart Count > 0`
    
    **å…¸å‹è¡¨ç°**:
    - Pod çŠ¶æ€åœ¨ Running å’Œ CrashLoopBackOff ä¹‹é—´åå¤åˆ‡æ¢
    - RESTARTS è®¡æ•°æŒç»­å¢åŠ 
    - æœåŠ¡æ— æ³•æ­£å¸¸æä¾›

    ## é—®é¢˜åŸç†
    
    Kubernetes æ£€æµ‹åˆ°å®¹å™¨é€€å‡ºåä¼šå°è¯•é‡å¯ã€‚å¦‚æœå®¹å™¨æŒç»­é€€å‡ºï¼Œkubelet ä¼šä½¿ç”¨**æŒ‡æ•°é€€é¿**ç­–ç•¥ï¼š
    
    **é€€é¿æ—¶é—´**: 10s â†’ 20s â†’ 40s â†’ 80s â†’ ... â†’ æœ€å¤§ 5 åˆ†é’Ÿ

    ## è¯Šæ–­å‘½ä»¤ï¼ˆæ ¸å¿ƒï¼‰

    ```bash
    # 1. è·å– Pod çŠ¶æ€å’Œ Exit Code
    kubectl describe pod <pod-name> -n <namespace> | grep -A 5 "Last State"
    
    # 2. è·å–å´©æºƒå‰çš„æ—¥å¿—ï¼ˆæœ€é‡è¦ï¼ï¼‰
    kubectl logs <pod-name> -n <namespace> --previous
    
    # 3. æŸ¥çœ‹ Pod äº‹ä»¶
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    ```

    ## Exit Code çŸ¥è¯†åº“

    | Exit Code | ä¿¡å· | å«ä¹‰ | å…¸å‹åœºæ™¯ |
    |-----------|------|------|---------|
    | 0 | - | æ­£å¸¸é€€å‡º | ä¸€æ¬¡æ€§ä»»åŠ¡å®Œæˆã€å¯åŠ¨å‘½ä»¤ç«‹å³é€€å‡º |
    | 1 | - | åº”ç”¨é”™è¯¯ | é…ç½®é”™è¯¯ã€ä¾èµ–ç¼ºå¤±ã€ä»£ç å¼‚å¸¸ |
    | 126 | - | æ— æ‰§è¡Œæƒé™ | è„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™ |
    | 127 | - | å‘½ä»¤ä¸å­˜åœ¨ | command é…ç½®é”™è¯¯ã€é•œåƒç¼ºå°‘ä¾èµ– |
    | 137 | SIGKILL(9) | **OOMKilled** | å†…å­˜è¶…é™è¢«ç³»ç»Ÿæ€æ­» |
    | 139 | SIGSEGV(11) | æ®µé”™è¯¯ | åº”ç”¨è®¿é—®éæ³•å†…å­˜ |
    | 143 | SIGTERM(15) | ä¼˜é›…ç»ˆæ­¢ | è¢« K8s ä¸»åŠ¨ç»ˆæ­¢ã€å¥åº·æ£€æŸ¥å¤±è´¥ |

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: OOMKilled (Exit Code 137) - å†…å­˜æº¢å‡º
    
    **äº‹ä»¶**: `Last State: Terminated, Reason: OOMKilled`
    
    **æ ¹å› **:
    - memory limit è®¾ç½®è¿‡ä½
    - åº”ç”¨å­˜åœ¨å†…å­˜æ³„æ¼
    - JVM -Xmx é…ç½®ä¸å½“
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹å®¹å™¨å†…å­˜é™åˆ¶
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].resources}'
    ```
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ å†…å­˜é™åˆ¶
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","resources":{"limits":{"memory":"1Gi"}}}]}}}}'
    ```

    ### åœºæ™¯ 2: åº”ç”¨é…ç½®é”™è¯¯ (Exit Code 1)
    
    **ç‰¹å¾**: æ—¥å¿—ä¸­æœ‰æ˜ç¡®çš„é…ç½®ç›¸å…³é”™è¯¯
    
    **æ ¹å› **:
    - ç¯å¢ƒå˜é‡ç¼ºå¤±æˆ–é”™è¯¯
    - ConfigMap/Secret é…ç½®é”™è¯¯
    - æ•°æ®åº“è¿æ¥ä¸²é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹å´©æºƒå‰æ—¥å¿—
    kubectl logs <pod-name> -n <namespace> --previous | tail -50
    
    # æ£€æŸ¥ç¯å¢ƒå˜é‡
    kubectl exec <pod-name> -n <namespace> -- env
    ```
    
    **ä¿®å¤**: ä¿®æ­£é…ç½®åé‡å¯
    ```bash
    kubectl rollout restart deployment <deploy-name> -n <namespace>
    ```

    ### åœºæ™¯ 3: å¯åŠ¨å‘½ä»¤é”™è¯¯ (Exit Code 0/127)
    
    **ç‰¹å¾**: Pod å¯åŠ¨åç«‹å³é€€å‡ºï¼Œæ—¥å¿—å¾ˆå°‘æˆ–æ²¡æœ‰
    
    **æ ¹å› **:
    - command/args é…ç½®é”™è¯¯
    - å…¥å£ç‚¹è„šæœ¬ç«‹å³é€€å‡º
    - é•œåƒä¸­ç¼ºå°‘æŒ‡å®šçš„å‘½ä»¤
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„å¯åŠ¨å‘½ä»¤
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].command}'
    ```
    
    **ä¿®å¤**: ä¿®æ­£ command é…ç½®

    ### åœºæ™¯ 4: ä¾èµ–æœåŠ¡ä¸å¯ç”¨ (Exit Code 1)
    
    **ç‰¹å¾**: æ—¥å¿—ä¸­æœ‰ `connection refused`ã€`timeout`ã€`ECONNREFUSED`
    
    **æ ¹å› **:
    - ä¾èµ–çš„æ•°æ®åº“ã€ç¼“å­˜ã€API ä¸å¯ç”¨
    - DNS è§£æå¤±è´¥
    - ç½‘ç»œç­–ç•¥é˜»æ­¢è®¿é—®
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥ä¾èµ–æœåŠ¡æ˜¯å¦å¯è¾¾
    kubectl exec <pod-name> -n <namespace> -- nc -zv <service-host> <port>
    ```
    
    **ä¿®å¤**: ç¡®ä¿ä¾èµ–æœåŠ¡å¯ç”¨

    ### åœºæ™¯ 5: å¥åº·æ£€æŸ¥è¿‡ä¸¥ (Exit Code 143)
    
    **ç‰¹å¾**: åº”ç”¨æ—¥å¿—æ­£å¸¸ï¼Œä½†è¢«é¢‘ç¹é‡å¯
    
    **æ ¹å› **:
    - livenessProbe è¶…æ—¶æ—¶é—´å¤ªçŸ­
    - initialDelaySeconds ä¸è¶³
    
    **ä¿®å¤**:
    ```bash
    # æ”¾å®½ livenessProbe
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","livenessProbe":{"initialDelaySeconds":60,"timeoutSeconds":10,"failureThreshold":5}}]}}}}'
    ```

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # åˆ é™¤ Pod è§¦å‘é‡å»º
    kubectl delete pod <pod-name> -n <namespace>
    
    # é‡å¯ Deployment
    kubectl rollout restart deployment <deploy-name> -n <namespace>
    
    # ä¸´æ—¶ç¦ç”¨å¥åº·æ£€æŸ¥è°ƒè¯•ï¼ˆå±é™©ï¼ä»…ç”¨äºè°ƒè¯•ï¼‰
    kubectl patch deployment <deploy-name> -n <namespace> --type='json' -p='[{"op":"remove","path":"/spec/template/spec/containers/0/livenessProbe"}]'
    ```

  # ==========================================================================
  # Pod æœªå°±ç»ª (Running ä½† 0/1 Ready)
  # ==========================================================================
  pod-not-ready.md: |
    # Pod æœªå°±ç»ª (Running ä½† 0/1 Ready) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod çŠ¶æ€ä¸º Runningï¼Œä½† READY åˆ—æ˜¾ç¤º 0/1ï¼ŒService æ— æ³•è·¯ç”±æµé‡
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å°±ç»ªæ£€æŸ¥å¤±è´¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Running (0/1 Ready)`ã€`Readiness probe failed`
    
    **å…¸å‹è¡¨ç°**:
    - Pod çŠ¶æ€æ˜¾ç¤º Runningï¼Œä½† READY åˆ—ä¸º `0/1`
    - Service Endpoints ä¸ºç©ºï¼Œæ— æ³•è®¿é—®æœåŠ¡
    - Pod äº‹ä»¶æ˜¾ç¤º `Readiness probe failed`

    ## é—®é¢˜åŸç†
    
    Kubernetes ä½¿ç”¨ **readinessProbe** åˆ¤æ–­ Pod æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚
    å¦‚æœ readinessProbe å¤±è´¥ï¼ŒPod ä¸ä¼šè¢«åŠ å…¥ Service çš„ Endpoints åˆ—è¡¨ã€‚

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod å°±ç»ªçŠ¶æ€
    kubectl get pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆå…³é”®ï¼ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Events
    
    # æŸ¥çœ‹ readinessProbe é…ç½®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].readinessProbe}'
    
    # æ£€æŸ¥ Service Endpoints
    kubectl get endpoints <service-name> -n <namespace>
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: å¥åº·æ£€æŸ¥è·¯å¾„é”™è¯¯
    
    **äº‹ä»¶**: `Readiness probe failed: HTTP probe failed with statuscode: 404`
    
    **æ ¹å› **: readinessProbe é…ç½®çš„ HTTP è·¯å¾„ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹é…ç½®çš„å¥åº·æ£€æŸ¥è·¯å¾„
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].readinessProbe.httpGet}'
    
    # æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
    kubectl exec <pod-name> -n <namespace> -- curl -v http://localhost:<port>/<path>
    ```
    
    **ä¿®å¤**: ä¿®æ­£ readinessProbe çš„ path å’Œ port

    ### åœºæ™¯ 2: åº”ç”¨å¯åŠ¨æ…¢
    
    **äº‹ä»¶**: å¥åº·æ£€æŸ¥åœ¨åº”ç”¨å®Œå…¨å¯åŠ¨å‰å°±å¼€å§‹æ£€æµ‹
    
    **æ ¹å› **: initialDelaySeconds è®¾ç½®è¿‡çŸ­
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ åˆå§‹å»¶è¿Ÿ
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","readinessProbe":{"initialDelaySeconds":30}}]}}}}'
    ```

    ### åœºæ™¯ 3: å¥åº·æ£€æŸ¥è¶…æ—¶
    
    **äº‹ä»¶**: `Readiness probe failed: context deadline exceeded`
    
    **æ ¹å› **: åº”ç”¨å“åº”å¤ªæ…¢ï¼Œè¶…è¿‡äº† timeoutSeconds
    
    **ä¿®å¤**: å¢åŠ  timeoutSeconds

    ### åœºæ™¯ 4: åº”ç”¨çœŸçš„æœ‰é—®é¢˜
    
    **ç‰¹å¾**: å¥åº·æ£€æŸ¥è¿”å›é 2xx çŠ¶æ€ç 
    
    **è¯Šæ–­**:
    ```bash
    # è¿›å…¥å®¹å™¨è°ƒè¯•
    kubectl exec -it <pod-name> -n <namespace> -- /bin/sh
    
    # æ‰‹åŠ¨æ£€æŸ¥å¥åº·æ¥å£
    curl -v http://localhost:<port>/healthz
    ```
    
    **ä¿®å¤**: æ’æŸ¥åº”ç”¨æœ¬èº«çš„é—®é¢˜

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # ä¸´æ—¶ç§»é™¤ readinessProbeï¼ˆç”¨äºè°ƒè¯•ï¼‰
    kubectl patch deployment <deploy-name> -n <namespace> --type='json' \
      -p='[{"op":"remove","path":"/spec/template/spec/containers/0/readinessProbe"}]'
    
    # æ”¾å®½å¥åº·æ£€æŸ¥é…ç½®
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","readinessProbe":{"initialDelaySeconds":60,"timeoutSeconds":10,"periodSeconds":10,"failureThreshold":6}}]}}}}'
    ```

  # ==========================================================================
  # Pod åˆ é™¤å¡ä½ (Terminating)
  # ==========================================================================
  pod-terminating.md: |
    # Pod åˆ é™¤å¡ä½ (Terminating) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº Terminating çŠ¶æ€ï¼Œæ— æ³•æ­£å¸¸åˆ é™¤
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod Terminating é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Terminating`ã€æ— æ³•åˆ é™¤
    
    **å…¸å‹è¡¨ç°**:
    - æ‰§è¡Œ `kubectl delete pod` åï¼ŒPod é•¿æ—¶é—´å¤„äº Terminating çŠ¶æ€
    - è¶…è¿‡ terminationGracePeriodSeconds ä»æœªåˆ é™¤

    ## é—®é¢˜åŸç†
    
    Pod åˆ é™¤æµç¨‹ï¼š
    1. K8s å‘é€ SIGTERM ä¿¡å·ç»™å®¹å™¨
    2. ç­‰å¾… terminationGracePeriodSecondsï¼ˆé»˜è®¤ 30sï¼‰
    3. å‘é€ SIGKILL å¼ºåˆ¶ç»ˆæ­¢
    4. æ¸…ç†èµ„æºã€ç§»é™¤ Finalizers
    5. ä» etcd ä¸­åˆ é™¤ Pod å¯¹è±¡

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod çŠ¶æ€
    kubectl get pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ Pod è¯¦æƒ…ï¼ˆå…³æ³¨ Finalizersï¼‰
    kubectl get pod <pod-name> -n <namespace> -o yaml | grep -A 5 finalizers
    
    # æŸ¥çœ‹ Pod æ‰€åœ¨èŠ‚ç‚¹
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.nodeName}'
    
    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: Finalizer é˜»å¡
    
    **ç‰¹å¾**: Pod æœ‰ Finalizersï¼Œç­‰å¾…æŸäº›èµ„æºæ¸…ç†
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.metadata.finalizers}'
    ```
    
    **ä¿®å¤**: ç§»é™¤ Finalizersï¼ˆè°¨æ…æ“ä½œï¼‰
    ```bash
    kubectl patch pod <pod-name> -n <namespace> -p '{"metadata":{"finalizers":null}}'
    ```

    ### åœºæ™¯ 2: èŠ‚ç‚¹ä¸å¯è¾¾
    
    **ç‰¹å¾**: Pod æ‰€åœ¨èŠ‚ç‚¹å¤„äº NotReady çŠ¶æ€
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod æ‰€åœ¨èŠ‚ç‚¹
    kubectl get pod <pod-name> -n <namespace> -o wide
    
    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes
    ```
    
    **ä¿®å¤**: æ¢å¤èŠ‚ç‚¹ï¼Œæˆ–å¼ºåˆ¶åˆ é™¤ Pod
    ```bash
    kubectl delete pod <pod-name> -n <namespace> --force --grace-period=0
    ```

    ### åœºæ™¯ 3: åº”ç”¨æ— æ³•ä¼˜é›…å…³é—­
    
    **ç‰¹å¾**: åº”ç”¨ä¸å“åº” SIGTERM ä¿¡å·
    
    **æ ¹å› **: åº”ç”¨æ²¡æœ‰å®ç°ä¼˜é›…å…³é—­é€»è¾‘
    
    **ä¿®å¤**:
    - çŸ­æœŸï¼šå¼ºåˆ¶åˆ é™¤ Pod
    - é•¿æœŸï¼šåº”ç”¨å®ç° SIGTERM å¤„ç†

    ### åœºæ™¯ 4: æŒ‚è½½çš„ Volume å¸è½½å¤±è´¥
    
    **ç‰¹å¾**: Pod ä½¿ç”¨äº† PVCï¼Œä½† Volume æ— æ³•å¸è½½
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Volumes
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ PV/PVC çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ¸…ç†

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # å¼ºåˆ¶åˆ é™¤ Podï¼ˆå¸¸ç”¨ï¼‰
    kubectl delete pod <pod-name> -n <namespace> --force --grace-period=0
    
    # ç§»é™¤ Finalizersï¼ˆå¦‚æœè¢« Finalizer é˜»å¡ï¼‰
    kubectl patch pod <pod-name> -n <namespace> -p '{"metadata":{"finalizers":null}}'
    
    # æ‰¹é‡å¼ºåˆ¶åˆ é™¤ Terminating çš„ Pod
    kubectl get pod -n <namespace> | grep Terminating | awk '{print $1}' | xargs -I {} kubectl delete pod {} -n <namespace> --force --grace-period=0
    ```

    ## âš ï¸ é£é™©æç¤º
    
    - å¼ºåˆ¶åˆ é™¤å¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼ï¼ˆå¦‚ Volume æœªæ­£å¸¸å¸è½½ï¼‰
    - Finalizers å­˜åœ¨æ˜¯æœ‰åŸå› çš„ï¼Œç§»é™¤å‰è¦ç¡®è®¤å½±å“
    - èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼ŒPod æ•°æ®å¯èƒ½ä¸¢å¤±

  # ==========================================================================
  # Pod è¢«é©±é€ (Evicted)
  # ==========================================================================
  pod-evicted.md: |
    # Pod è¢«é©±é€ (Evicted) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod çŠ¶æ€ä¸º Evictedï¼Œè¢«èŠ‚ç‚¹é©±é€
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod é©±é€é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Evicted`ã€`The node was low on resource`
    
    **å…¸å‹äº‹ä»¶**:
    - `The node was low on resource: ephemeral-storage`
    - `The node was low on resource: memory`
    - `Pod ephemeral local storage usage exceeds the total limit`

    ## é—®é¢˜åŸç†
    
    å½“èŠ‚ç‚¹èµ„æºç´§å¼ æ—¶ï¼Œkubelet ä¼š**é©±é€**ä½ä¼˜å…ˆçº§ Pod ä»¥é‡Šæ”¾èµ„æºï¼š
    
    **é©±é€è§¦å‘æ¡ä»¶**:
    - å†…å­˜å‹åŠ›ï¼ˆmemory.available < 100Miï¼‰
    - ç£ç›˜å‹åŠ›ï¼ˆnodefs.available < 10%ï¼‰
    - ephemeral-storage è¶…é™

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥æ‰¾è¢«é©±é€çš„ Pod
    kubectl get pod -A | grep Evicted
    
    # æŸ¥çœ‹é©±é€åŸå› 
    kubectl describe pod <evicted-pod> -n <namespace> | grep -A 5 Status
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºå‹åŠ›
    kubectl describe nodes | grep -A 10 Conditions
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: ephemeral-storage è¶…é™ï¼ˆæœ€å¸¸è§ï¼‰
    
    **äº‹ä»¶**: `Pod ephemeral local storage usage exceeds the total limit`
    
    **æ ¹å› **: å®¹å™¨å†™å…¥çš„æ•°æ®è¶…è¿‡äº† limits.ephemeral-storage é™åˆ¶
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„ ephemeral-storage é™åˆ¶
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].resources.limits}'
    ```
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ  ephemeral-storage é™åˆ¶
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","resources":{"limits":{"ephemeral-storage":"1Gi"}}}]}}}}'
    ```

    ### åœºæ™¯ 2: èŠ‚ç‚¹å†…å­˜å‹åŠ›
    
    **äº‹ä»¶**: `The node was low on resource: memory`
    
    **æ ¹å› **: èŠ‚ç‚¹å†…å­˜ç´§å¼ ï¼Œkubelet é©±é€ä½ä¼˜å…ˆçº§ Pod
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹å†…å­˜æƒ…å†µ
    kubectl describe node <node-name> | grep -A 5 "Allocated resources"
    ```
    
    **ä¿®å¤**:
    - è®¾ç½®åˆç†çš„ requests/limits
    - æ‰©å®¹èŠ‚ç‚¹
    - è®¾ç½® PriorityClass ä¿æŠ¤é‡è¦ Pod

    ### åœºæ™¯ 3: èŠ‚ç‚¹ç£ç›˜å‹åŠ›
    
    **äº‹ä»¶**: `The node was low on resource: ephemeral-storage`
    
    **æ ¹å› **: èŠ‚ç‚¹ç£ç›˜ç©ºé—´ä¸è¶³
    
    **ä¿®å¤**:
    - æ¸…ç†èŠ‚ç‚¹ç£ç›˜ï¼ˆå‚è€ƒ disk-full æ‰‹å†Œï¼‰
    - ä½¿ç”¨ PVC å­˜å‚¨å¤§æ–‡ä»¶

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æ¸…ç†æ‰€æœ‰ Evicted Pod
    kubectl get pod -A | grep Evicted | awk '{print $2 " -n " $1}' | xargs -L1 kubectl delete pod
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºåˆ†é…æƒ…å†µ
    kubectl describe nodes | grep -A 20 "Allocated resources"
    ```

    ## é¢„é˜²æªæ–½
    
    - è®¾ç½®åˆç†çš„ requests/limits
    - ä½¿ç”¨ PVC å­˜å‚¨å¤§æ–‡ä»¶ï¼Œä¸è¦å†™å…¥å®¹å™¨å±‚
    - é…ç½® PodDisruptionBudget ä¿æŠ¤å…³é”®æœåŠ¡
    - è®¾ç½®èŠ‚ç‚¹èµ„æºå‘Šè­¦

  # ==========================================================================
  # L0: ç£ç›˜ç©ºé—´è€—å°½
  # ==========================================================================
  infra-disk-full.md: |
    # ç£ç›˜ç©ºé—´è€—å°½ (No space left on device) è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L0` - åŸºç¡€è®¾æ–½å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´çš„å„ç±»å¼‚å¸¸

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `No space left on device`ã€`disk full`ã€`ENOSPC`
    
    **å…¸å‹è¡¨ç°**:
    - æ—¥å¿—å†™å…¥å¤±è´¥
    - é•œåƒæ‹‰å–å¤±è´¥
    - æ•°æ®åº“æ— æ³•å†™å…¥
    - Pod æ— æ³•å¯åŠ¨
    - etcd æŠ¥é”™

    ## é—®é¢˜åŸç†

    Linux æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§é™åˆ¶ï¼š
    1. **Block ç©ºé—´**: å®é™…å­˜å‚¨æ•°æ®çš„ç©ºé—´ (`df -h` æŸ¥çœ‹)
    2. **Inode æ•°é‡**: æ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹ (`df -i` æŸ¥çœ‹)

    ä»»ä¸€è€—å°½éƒ½ä¼šå¯¼è‡´ "No space left on device"

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ç‡ï¼ˆBlockï¼‰
    df -h
    
    # 2. æŸ¥çœ‹ Inode ä½¿ç”¨ç‡
    df -i
    
    # 3. å®šä½å¤§ç›®å½•ï¼ˆä»æ ¹ç›®å½•é€å±‚ï¼‰
    du -sh /* 2>/dev/null | sort -hr | head -20
    du -sh /var/* 2>/dev/null | sort -hr | head -10
    
    # 4. æŸ¥æ‰¾å¤§æ–‡ä»¶ï¼ˆ>100Mï¼‰
    find /var -type f -size +100M 2>/dev/null | head -20
    
    # 5. æŸ¥çœ‹ Docker ç£ç›˜å ç”¨
    docker system df
    
    # 6. æŸ¥çœ‹å·²åˆ é™¤ä½†æœªé‡Šæ”¾çš„æ–‡ä»¶ï¼ˆè¢«è¿›ç¨‹å ç”¨ï¼‰
    lsof +L1 | grep deleted | head -20
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: æ—¥å¿—è†¨èƒ€ (/var/log)

    **æ ¹å› **: åº”ç”¨æ—¥å¿—æœªé…ç½® logrotateï¼Œæˆ–æ—¥å¿—çº§åˆ«è¿‡ä½
    
    **è¯Šæ–­**:
    ```bash
    du -sh /var/log/* | sort -hr | head -10
    ls -lhS /var/log/*.log | head -10
    ```
    
    **ä¿®å¤**:
    ```bash
    # æ¸…ç†æ—¥å¿—ï¼ˆä¿ç•™æ–‡ä»¶å¥æŸ„ï¼‰
    truncate -s 0 /var/log/xxx.log
    
    # ä¸è¦ç”¨ rmï¼ä¼šå¯¼è‡´è¿›ç¨‹ç»§ç»­å ç”¨å·²åˆ é™¤æ–‡ä»¶çš„ç©ºé—´
    ```

    ### åœºæ™¯ 2: Docker é•œåƒå †ç§¯ (/var/lib/docker)

    **æ ¹å› **: æ—§é•œåƒæœªæ¸…ç†ã€æ„å»ºç¼“å­˜å †ç§¯
    
    **è¯Šæ–­**:
    ```bash
    docker system df
    docker images | wc -l
    ```
    
    **ä¿®å¤**:
    ```bash
    # æ¸…ç†æœªä½¿ç”¨çš„èµ„æºï¼ˆè°¨æ…ï¼ä¼šåˆ é™¤æœªä½¿ç”¨é•œåƒï¼‰
    docker system prune -af
    
    # åªæ¸…ç† dangling é•œåƒ
    docker image prune -f
    
    # æ¸…ç†æ„å»ºç¼“å­˜
    docker builder prune -af
    ```

    ### åœºæ™¯ 3: containerd é•œåƒå †ç§¯ (/var/lib/containerd)

    **æ ¹å› **: K8s èŠ‚ç‚¹é•¿æœŸè¿è¡Œï¼Œé•œåƒæœªæ¸…ç†
    
    **ä¿®å¤**:
    ```bash
    # æŸ¥çœ‹ containerd é•œåƒ
    crictl images
    
    # æ¸…ç†æœªä½¿ç”¨é•œåƒ
    crictl rmi --prune
    ```

    ### åœºæ™¯ 4: Inode è€—å°½

    **ç‰¹å¾**: `df -h` æ˜¾ç¤ºæœ‰ç©ºé—´ï¼Œä½†ä»æŠ¥é”™
    
    **æ ¹å› **: å¤§é‡å°æ–‡ä»¶ï¼ˆå¦‚ session æ–‡ä»¶ã€ç¼“å­˜æ–‡ä»¶ï¼‰
    
    **è¯Šæ–­**:
    ```bash
    df -i
    find /var -xdev -type f | cut -d "/" -f 2-3 | sort | uniq -c | sort -rn | head -20
    ```
    
    **ä¿®å¤**: æ¸…ç†å°æ–‡ä»¶ç›®å½•

    ### åœºæ™¯ 5: å·²åˆ é™¤ä½†æœªé‡Šæ”¾çš„ç©ºé—´

    **ç‰¹å¾**: åˆ é™¤äº†å¤§æ–‡ä»¶ï¼Œä½†ç©ºé—´æœªé‡Šæ”¾
    
    **æ ¹å› **: è¿›ç¨‹ä»æŒæœ‰å·²åˆ é™¤æ–‡ä»¶çš„å¥æŸ„
    
    **è¯Šæ–­**:
    ```bash
    lsof +L1 | grep deleted
    ```
    
    **ä¿®å¤**: é‡å¯å ç”¨è¿›ç¨‹ï¼Œæˆ–ç”¨ `truncate` ä»£æ›¿ `rm`

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # å¿«é€Ÿæ¸…ç†ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰
    # 1. æ¸…ç†æ—¥å¿—
    find /var/log -name "*.log" -size +100M -exec truncate -s 0 {} \;
    
    # 2. æ¸…ç†ç³»ç»Ÿç¼“å­˜
    sync && echo 3 > /proc/sys/vm/drop_caches
    
    # 3. æ¸…ç† apt ç¼“å­˜ï¼ˆDebian/Ubuntuï¼‰
    apt-get clean
    
    # 4. æ¸…ç† journal æ—¥å¿—
    journalctl --vacuum-size=100M
    ```

    ## âš ï¸ é£é™©æç¤º

    - **ä¸è¦ç”¨ `rm -rf /var/log/*`**: å¯èƒ½åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶
    - **docker system prune -af** ä¼šåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨é•œåƒ
    - æ¸…ç†å‰åŠ¡å¿…ç¡®è®¤ç›®æ ‡ç›®å½•

  # ==========================================================================
  # L0: ç³»ç»Ÿå†…å­˜è€—å°½
  # ==========================================================================
  infra-memory-exhausted.md: |
    # ç³»ç»Ÿå†…å­˜è€—å°½è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L0` - åŸºç¡€è®¾æ–½å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: ç³»ç»Ÿå†…å­˜ä¸è¶³å¯¼è‡´è¿›ç¨‹è¢« OOM Killer æ€æ­»

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `Out of memory`ã€`Killed`ã€`oom-kill`ã€`Cannot allocate memory`
    
    **å…¸å‹è¡¨ç°**:
    - è¿›ç¨‹è¢«çªç„¶æ€æ­»
    - ç³»ç»Ÿå“åº”å˜æ…¢
    - æ–°è¿›ç¨‹æ— æ³•å¯åŠ¨
    - dmesg ä¸­å‡ºç° oom-kill è®°å½•

    ## é—®é¢˜åŸç†

    Linux å†…å­˜ç®¡ç†ï¼š
    1. **ç‰©ç†å†…å­˜ + Swap**: å®é™…å¯ç”¨å†…å­˜
    2. **OOM Killer**: å½“å†…å­˜è€—å°½æ—¶ï¼Œå†…æ ¸é€‰æ‹©æ€§æ€æ­»è¿›ç¨‹é‡Šæ”¾å†…å­˜
    3. **OOM Score**: æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œåˆ†æ•°è¶Šé«˜è¶Šå®¹æ˜“è¢«æ€

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ¦‚å†µ
    free -h
    
    # 2. æŸ¥çœ‹å†…å­˜è¯¦ç»†ä¿¡æ¯
    cat /proc/meminfo | head -20
    
    # 3. æŸ¥çœ‹è¢« OOM Killer æ€æ­»çš„è¿›ç¨‹
    dmesg | grep -i "oom-kill\|out of memory" | tail -20
    journalctl -k | grep -i oom
    
    # 4. æŸ¥çœ‹è¿›ç¨‹å†…å­˜å ç”¨æ’åº
    ps aux --sort=-%mem | head -20
    
    # 5. æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨
    cat /proc/<pid>/status | grep -E "VmRSS|VmSize"
    
    # 6. æŸ¥çœ‹ OOM Scoreï¼ˆè°æœ€å®¹æ˜“è¢«æ€ï¼‰
    for pid in $(pgrep .); do 
      echo "$pid $(cat /proc/$pid/oom_score 2>/dev/null) $(cat /proc/$pid/comm 2>/dev/null)"
    done | sort -k2 -rn | head -20
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: åº”ç”¨å†…å­˜æ³„æ¼

    **ç‰¹å¾**: æŸä¸ªè¿›ç¨‹å†…å­˜æŒç»­å¢é•¿ï¼Œæœ€ç»ˆè§¦å‘ OOM
    
    **è¯Šæ–­**:
    ```bash
    # è§‚å¯Ÿè¿›ç¨‹å†…å­˜å˜åŒ–
    watch -n 5 'ps aux --sort=-%mem | head -10'
    
    # ä½¿ç”¨ Prometheus æŸ¥è¯¢å†å²å†…å­˜è¶‹åŠ¿
    # container_memory_usage_bytes{pod="xxx"}
    ```
    
    **ä¿®å¤**:
    - çŸ­æœŸï¼šé‡å¯è¿›ç¨‹é‡Šæ”¾å†…å­˜
    - é•¿æœŸï¼šæ’æŸ¥åº”ç”¨å†…å­˜æ³„æ¼

    ### åœºæ™¯ 2: å†…å­˜ Limit è®¾ç½®ä¸åˆç†

    **ç‰¹å¾**: Pod è¢«é¢‘ç¹ OOMKilledï¼Œä½†èŠ‚ç‚¹å†…å­˜å……è¶³
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe pod <pod> | grep -A 5 "Last State"
    kubectl get pod <pod> -o jsonpath='{.spec.containers[*].resources}'
    ```
    
    **ä¿®å¤**: è°ƒæ•´ Pod çš„ memory limits

    ### åœºæ™¯ 3: ç³»ç»Ÿç¼“å­˜å ç”¨è¿‡é«˜

    **ç‰¹å¾**: `free -h` æ˜¾ç¤ºå¯ç”¨å†…å­˜å¾ˆå°‘ï¼Œä½† buff/cache å¾ˆé«˜
    
    **è¯´æ˜**: è¿™é€šå¸¸æ˜¯æ­£å¸¸çš„ï¼Linux ä¼šåˆ©ç”¨ç©ºé—²å†…å­˜åšç¼“å­˜
    
    **éªŒè¯**:
    ```bash
    # available æ‰æ˜¯çœŸæ­£å¯ç”¨çš„å†…å­˜
    free -h | grep Mem
    ```
    
    **å¦‚éœ€é‡Šæ”¾ç¼“å­˜**:
    ```bash
    sync && echo 3 > /proc/sys/vm/drop_caches
    ```

    ### åœºæ™¯ 4: Swap æœªå¯ç”¨æˆ–è¿‡å°

    **ç‰¹å¾**: æ²¡æœ‰ Swap ç¼“å†²ï¼ŒOOM è§¦å‘æ›´é¢‘ç¹
    
    **è¯Šæ–­**:
    ```bash
    free -h | grep Swap
    swapon --show
    ```
    
    **è¯´æ˜**: K8s ç¯å¢ƒé€šå¸¸ç¦ç”¨ Swap

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹å½“å‰å†…å­˜çŠ¶æ€
    free -h
    
    # æŸ¥çœ‹å†…å­˜å¤§æˆ·
    ps aux --sort=-%mem | head -10
    
    # é‡Šæ”¾ PageCacheï¼ˆä¸´æ—¶æªæ–½ï¼‰
    sync && echo 1 > /proc/sys/vm/drop_caches
    
    # è°ƒæ•´è¿›ç¨‹ OOM ä¼˜å…ˆçº§ï¼ˆä¸æ˜“è¢«æ€ï¼‰
    echo -1000 > /proc/<pid>/oom_score_adj
    
    # æŸ¥çœ‹ OOM å†å²
    dmesg | grep -i oom | tail -20
    ```

    ## è¯æ®æ¥æºæ˜ å°„

    | è¯æ® | æ¥æºå‘½ä»¤ | è¯´æ˜ |
    |------|---------|------|
    | å†…å­˜ä½¿ç”¨ç‡ | `free -h` | ç³»ç»Ÿæ•´ä½“å†…å­˜çŠ¶æ€ |
    | OOM äº‹ä»¶ | `dmesg \| grep oom` | å“ªä¸ªè¿›ç¨‹è¢«æ€ |
    | è¿›ç¨‹å†…å­˜ | `ps aux --sort=-%mem` | è°å ç”¨æœ€å¤š |
    | å®¹å™¨å†…å­˜ | `kubectl describe pod` | K8s å±‚é¢çš„ OOM ä¿¡æ¯ |

  # ==========================================================================
  # L0: CPU é¥±å’Œ
  # ==========================================================================
  infra-cpu-saturation.md: |
    # CPU é¥±å’Œè¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L0` - åŸºç¡€è®¾æ–½å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: CPU ä½¿ç”¨ç‡è¿‡é«˜å¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `high load`ã€`CPU 100%`ã€`å“åº”æ…¢`ã€`å¡é¡¿`
    
    **å…¸å‹è¡¨ç°**:
    - ç³»ç»Ÿå“åº”ç¼“æ…¢
    - SSH è¿æ¥å›°éš¾
    - å‘½ä»¤æ‰§è¡Œå»¶è¿Ÿ
    - Load Average å¼‚å¸¸é«˜

    ## é—®é¢˜åŸç†

    **Load Average**: è¡¨ç¤ºç³»ç»Ÿè´Ÿè½½
    - ç­‰äº CPU æ ¸å¿ƒæ•°: åˆšå¥½æ»¡è½½
    - è¶…è¿‡ CPU æ ¸å¿ƒæ•°: è¿‡è½½ï¼Œè¿›ç¨‹éœ€è¦æ’é˜Ÿ

    **CPU ä½¿ç”¨ç±»å‹**:
    - `us` (user): ç”¨æˆ·æ€ï¼Œåº”ç”¨ç¨‹åº
    - `sy` (system): å†…æ ¸æ€ï¼Œç³»ç»Ÿè°ƒç”¨
    - `wa` (iowait): ç­‰å¾… I/O
    - `si` (softirq): è½¯ä¸­æ–­

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹ Load Average
    uptime
    cat /proc/loadavg
    
    # 2. æŸ¥çœ‹ CPU æ ¸å¿ƒæ•°ï¼ˆå¯¹æ¯” Load Averageï¼‰
    nproc
    
    # 3. å®æ—¶æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µ
    top -bn1 | head -20
    
    # 4. æŒ‰ CPU æ’åºæŸ¥çœ‹è¿›ç¨‹
    ps aux --sort=-%cpu | head -20
    
    # 5. æŸ¥çœ‹ CPU ä½¿ç”¨ç»†åˆ†
    mpstat -P ALL 1 5
    
    # 6. æŸ¥çœ‹ä¸­æ–­æƒ…å†µ
    cat /proc/interrupts
    
    # 7. ä½¿ç”¨ pidstat æŸ¥çœ‹è¿›ç¨‹ CPU ä½¿ç”¨
    pidstat -u 1 5
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: æŸä¸ªè¿›ç¨‹ CPU 100%

    **ç‰¹å¾**: å•ä¸ªè¿›ç¨‹å ç”¨æ¥è¿‘ 100% CPU
    
    **è¯Šæ–­**:
    ```bash
    top -bn1 | head -15
    ps aux --sort=-%cpu | head -5
    
    # æŸ¥çœ‹è¯¥è¿›ç¨‹åœ¨åšä»€ä¹ˆ
    strace -p <pid> -c
    ```
    
    **ä¿®å¤**:
    - å¦‚æ˜¯æ­»å¾ªç¯/Bug: é‡å¯è¿›ç¨‹
    - å¦‚æ˜¯æ­£å¸¸ä¸šåŠ¡: å¢åŠ  CPU é™åˆ¶æˆ–æ‰©å®¹

    ### åœºæ™¯ 2: é«˜ IO Wait

    **ç‰¹å¾**: `wa` å€¼å¾ˆé«˜ï¼Œä½† `us`/`sy` ä¸é«˜
    
    **æ ¹å› **: CPU åœ¨ç­‰å¾…ç£ç›˜ I/Oï¼Œé€šå¸¸æ˜¯ç£ç›˜ç“¶é¢ˆ
    
    **è¯Šæ–­**:
    ```bash
    iostat -x 1 5
    iotop -o
    ```
    
    **ä¿®å¤**: ä¼˜åŒ–ç£ç›˜ I/O æˆ–å‡çº§å­˜å‚¨

    ### åœºæ™¯ 3: è½¯ä¸­æ–­è¿‡é«˜ (si)

    **ç‰¹å¾**: `si` å€¼å¾ˆé«˜
    
    **æ ¹å› **: ç½‘ç»œæµé‡è¿‡å¤§ã€å¤§é‡ç½‘ç»œåŒ…å¤„ç†
    
    **è¯Šæ–­**:
    ```bash
    cat /proc/softirqs
    sar -n DEV 1 5
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ç½‘ç»œæµé‡ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ RPS/RFS

    ### åœºæ™¯ 4: K8s èŠ‚ç‚¹ CPU è¿‡è½½

    **ç‰¹å¾**: å¤šä¸ª Pod åŒæ—¶æ¶ˆè€— CPU
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹ CPU åˆ†é…
    kubectl describe node <node> | grep -A 10 "Allocated resources"
    
    # ä½¿ç”¨ Prometheus æŸ¥è¯¢
    # sum(rate(container_cpu_usage_seconds_total{node="xxx"}[5m])) by (pod)
    ```
    
    **ä¿®å¤**:
    - è®¾ç½®åˆç†çš„ CPU requests/limits
    - ä½¿ç”¨ LimitRange é™åˆ¶å•ä¸ª Pod æœ€å¤§ CPU
    - èŠ‚ç‚¹æ‰©å®¹

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹å½“å‰è´Ÿè½½
    uptime && nproc
    
    # æŸ¥çœ‹ CPU å¤§æˆ·
    ps aux --sort=-%cpu | head -10
    
    # é™ä½è¿›ç¨‹ä¼˜å…ˆçº§
    renice 19 -p <pid>
    
    # é™åˆ¶è¿›ç¨‹ CPUï¼ˆéœ€è¦ cgroupsï¼‰
    # æˆ–ä½¿ç”¨ cpulimit å·¥å…·
    cpulimit -p <pid> -l 50
    
    # æ€æ­»å¤±æ§è¿›ç¨‹
    kill -9 <pid>
    ```

    ## è¯æ®æ¥æºæ˜ å°„

    | è¯æ® | æ¥æºå‘½ä»¤ | è¯´æ˜ |
    |------|---------|------|
    | Load Average | `uptime` | ç³»ç»Ÿæ•´ä½“è´Ÿè½½ |
    | CPU ä½¿ç”¨ç‡ | `top` / `mpstat` | CPU ä½¿ç”¨ç»†åˆ† |
    | è¿›ç¨‹ CPU | `ps aux --sort=-%cpu` | å“ªä¸ªè¿›ç¨‹å ç”¨æœ€å¤š |
    | IO Wait | `iostat` | æ˜¯å¦æ˜¯ I/O å¯¼è‡´ |
    | å®¹å™¨ CPU | Prometheus | K8s å±‚é¢ CPU ä½¿ç”¨ |

  # ==========================================================================
  # L1: èŠ‚ç‚¹å¼‚å¸¸ (NotReady)
  # ==========================================================================
  node-not-ready.md: |
    # èŠ‚ç‚¹å¼‚å¸¸ (NotReady) è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L1` - é›†ç¾¤ä¸èŠ‚ç‚¹å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: K8s èŠ‚ç‚¹å¤„äº NotReady çŠ¶æ€

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `NotReady`ã€`Unknown`ã€`NodeNotReady`
    
    **å…¸å‹è¡¨ç°**:
    - `kubectl get nodes` æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¸º NotReady
    - èŠ‚ç‚¹ä¸Šçš„ Pod è¢«é©±é€æˆ–å¤„äº Unknown
    - æ–° Pod æ— æ³•è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹

    ## é—®é¢˜åŸç†

    èŠ‚ç‚¹çŠ¶æ€ç”± **kubelet** å®šæœŸä¸ŠæŠ¥ç»™ API Serverï¼š
    - é»˜è®¤æ¯ 10s ä¸ŠæŠ¥ä¸€æ¬¡å¿ƒè·³
    - å¦‚æœ 40s æ²¡æ”¶åˆ°å¿ƒè·³ï¼ŒèŠ‚ç‚¹å˜ä¸º Unknown
    - å¦‚æœ 5 åˆ†é’Ÿä»æ— å¿ƒè·³ï¼ŒPod å¼€å§‹è¢«é©±é€

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes -o wide
    
    # 2. æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…å’Œ Conditions
    kubectl describe node <node-name>
    
    # 3. æŸ¥çœ‹èŠ‚ç‚¹äº‹ä»¶
    kubectl get events --field-selector involvedObject.name=<node-name>
    
    # 4. æ£€æŸ¥ kubelet çŠ¶æ€ï¼ˆéœ€ç™»å½•èŠ‚ç‚¹ï¼‰
    systemctl status kubelet
    journalctl -u kubelet --since "30 minutes ago" | tail -100
    
    # 5. æ£€æŸ¥å®¹å™¨è¿è¡Œæ—¶
    systemctl status containerd
    # æˆ–
    systemctl status docker
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: kubelet æœåŠ¡åœæ­¢

    **ç‰¹å¾**: èŠ‚ç‚¹ä¸Š kubelet è¿›ç¨‹ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    systemctl status kubelet
    ```
    
    **ä¿®å¤**:
    ```bash
    systemctl restart kubelet
    journalctl -u kubelet -f  # æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
    ```

    ### åœºæ™¯ 2: kubelet æ— æ³•è¿æ¥ API Server

    **ç‰¹å¾**: kubelet æ—¥å¿—æ˜¾ç¤ºè¿æ¥è¶…æ—¶
    
    **è¯Šæ–­**:
    ```bash
    journalctl -u kubelet | grep -i "connection\|timeout\|refused"
    
    # æµ‹è¯•ç½‘ç»œè¿é€šæ€§
    curl -k https://<api-server>:6443/healthz
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ç½‘ç»œå’Œé˜²ç«å¢™

    ### åœºæ™¯ 3: å®¹å™¨è¿è¡Œæ—¶å¼‚å¸¸

    **ç‰¹å¾**: kubelet æ—¥å¿—æ˜¾ç¤ºæ— æ³•è¿æ¥ containerd/docker
    
    **è¯Šæ–­**:
    ```bash
    systemctl status containerd
    crictl ps
    ```
    
    **ä¿®å¤**:
    ```bash
    systemctl restart containerd
    systemctl restart kubelet
    ```

    ### åœºæ™¯ 4: ç£ç›˜/å†…å­˜å‹åŠ›

    **ç‰¹å¾**: èŠ‚ç‚¹æœ‰ DiskPressure/MemoryPressure Condition
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe node <node> | grep -A 5 Conditions
    ```
    
    **ä¿®å¤**: å‚è€ƒ L0 ç£ç›˜/å†…å­˜è¯Šæ–­æ‰‹å†Œ

    ### åœºæ™¯ 5: è¯ä¹¦è¿‡æœŸ

    **ç‰¹å¾**: kubelet æ—¥å¿—æ˜¾ç¤º TLS/è¯ä¹¦é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    openssl x509 -in /var/lib/kubelet/pki/kubelet-client-current.pem -noout -dates
    ```
    
    **ä¿®å¤**: æ›´æ–°è¯ä¹¦

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # é‡å¯ kubelet
    systemctl restart kubelet
    
    # é‡å¯å®¹å™¨è¿è¡Œæ—¶
    systemctl restart containerd
    
    # å¼ºåˆ¶èŠ‚ç‚¹æ¢å¤ï¼ˆéœ€è°¨æ…ï¼‰
    kubectl uncordon <node-name>
    
    # é©±é€èŠ‚ç‚¹ä¸Šçš„ Podï¼ˆç»´æŠ¤æ—¶ï¼‰
    kubectl drain <node-name> --ignore-daemonsets --delete-emptydir-data
    ```

    ## è¯æ®æ¥æºæ˜ å°„

    | è¯æ® | æ¥æºå‘½ä»¤ | è¯´æ˜ |
    |------|---------|------|
    | èŠ‚ç‚¹çŠ¶æ€ | `kubectl get nodes` | Ready/NotReady |
    | èŠ‚ç‚¹æ¡ä»¶ | `kubectl describe node` | å…·ä½“å¼‚å¸¸åŸå›  |
    | kubelet æ—¥å¿— | `journalctl -u kubelet` | è¯¦ç»†é”™è¯¯ä¿¡æ¯ |
    | è¿è¡Œæ—¶çŠ¶æ€ | `systemctl status containerd` | å®¹å™¨è¿è¡Œæ—¶ |

  # ==========================================================================
  # L1: èŠ‚ç‚¹ç£ç›˜å‹åŠ› (DiskPressure)
  # ==========================================================================
  node-disk-pressure.md: |
    # èŠ‚ç‚¹ç£ç›˜å‹åŠ› (DiskPressure) è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L1` - é›†ç¾¤ä¸èŠ‚ç‚¹å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: èŠ‚ç‚¹å‡ºç° DiskPressure æ¡ä»¶

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `DiskPressure`ã€`nodefs.available`ã€`imagefs.available`
    
    **å…¸å‹è¡¨ç°**:
    - `kubectl describe node` æ˜¾ç¤º DiskPressure=True
    - Pod è¢«é©±é€
    - æ–° Pod æ— æ³•è°ƒåº¦

    ## é—®é¢˜åŸç†

    kubelet ç›‘æ§ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼š
    1. **nodefs**: èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿï¼ˆ/var/lib/kubeletï¼‰
    2. **imagefs**: é•œåƒæ–‡ä»¶ç³»ç»Ÿï¼ˆ/var/lib/docker æˆ– /var/lib/containerdï¼‰

    **é»˜è®¤é©±é€é˜ˆå€¼**:
    - `nodefs.available < 10%` â†’ DiskPressure
    - `imagefs.available < 15%` â†’ å¼€å§‹æ¸…ç†é•œåƒ

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹èŠ‚ç‚¹æ¡ä»¶
    kubectl describe node <node> | grep -A 5 Conditions
    
    # 2. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ï¼ˆç™»å½•èŠ‚ç‚¹ï¼‰
    df -h
    
    # 3. æŸ¥çœ‹ kubelet é©±é€é˜ˆå€¼é…ç½®
    cat /var/lib/kubelet/config.yaml | grep -A 10 eviction
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: /var/lib/docker æˆ– /var/lib/containerd æ»¡

    **æ ¹å› **: é•œåƒå’Œå®¹å™¨æ•°æ®å †ç§¯
    
    **ä¿®å¤**:
    ```bash
    # æ¸…ç†æœªä½¿ç”¨é•œåƒ
    crictl rmi --prune
    # æˆ–
    docker system prune -af
    ```

    ### åœºæ™¯ 2: å®¹å™¨æ—¥å¿—å ç”¨ç©ºé—´

    **æ ¹å› **: å®¹å™¨ stdout/stderr æ—¥å¿—æœªé™åˆ¶
    
    **è¯Šæ–­**:
    ```bash
    find /var/lib/docker/containers -name "*-json.log" -size +100M
    ```
    
    **ä¿®å¤**: é…ç½® Docker/containerd æ—¥å¿—è½®è½¬

    ### åœºæ™¯ 3: emptyDir æˆ– hostPath å ç”¨

    **æ ¹å› **: Pod å†™å…¥å¤§é‡æ•°æ®åˆ° emptyDir/hostPath
    
    **è¯Šæ–­**:
    ```bash
    du -sh /var/lib/kubelet/pods/*/volumes/*
    ```

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æ¸…ç†é•œåƒ
    crictl rmi --prune
    
    # æ¸…ç†å·²åœæ­¢å®¹å™¨
    crictl rm $(crictl ps -a -q --state exited)
    
    # æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶
    # kubelet ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œä¹Ÿå¯ç­‰å¾…
    ```

  # ==========================================================================
  # L1: èŠ‚ç‚¹å†…å­˜å‹åŠ› (MemoryPressure)
  # ==========================================================================
  node-memory-pressure.md: |
    # èŠ‚ç‚¹å†…å­˜å‹åŠ› (MemoryPressure) è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L1` - é›†ç¾¤ä¸èŠ‚ç‚¹å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: èŠ‚ç‚¹å‡ºç° MemoryPressure æ¡ä»¶

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `MemoryPressure`ã€`memory.available`
    
    **å…¸å‹è¡¨ç°**:
    - `kubectl describe node` æ˜¾ç¤º MemoryPressure=True
    - Pod è¢«é©±é€
    - ç³»ç»Ÿå¯èƒ½è§¦å‘ OOM Killer

    ## é—®é¢˜åŸç†

    kubelet ç›‘æ§å¯ç”¨å†…å­˜ï¼š
    - é»˜è®¤é˜ˆå€¼: `memory.available < 100Mi`
    - è§¦å‘åå¼€å§‹é©±é€ BestEffort å’Œ Burstable Pod

    **é©±é€ä¼˜å…ˆçº§**:
    1. BestEffort Podï¼ˆæ—  requests/limitsï¼‰
    2. Burstable Podï¼ˆä½¿ç”¨è¶…è¿‡ requestsï¼‰
    3. Guaranteed Podï¼ˆæœ€åè¢«é©±é€ï¼‰

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹èŠ‚ç‚¹æ¡ä»¶
    kubectl describe node <node> | grep -A 5 Conditions
    
    # 2. æŸ¥çœ‹å†…å­˜ä½¿ç”¨
    free -h
    
    # 3. æŸ¥çœ‹è¢«é©±é€çš„ Pod
    kubectl get pod -A | grep Evicted
    
    # 4. æŸ¥çœ‹èŠ‚ç‚¹èµ„æºåˆ†é…
    kubectl describe node <node> | grep -A 10 "Allocated resources"
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: èµ„æºè¶…å–

    **æ ¹å› **: èŠ‚ç‚¹ä¸Š Pod çš„ requests æ€»å’Œè¿‡å¤§
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe node <node> | grep -A 10 "Allocated resources"
    ```
    
    **ä¿®å¤**:
    - å‡å°‘ Pod æ•°é‡
    - é™ä½ Pod çš„ requests
    - æ‰©å®¹èŠ‚ç‚¹

    ### åœºæ™¯ 2: æŸä¸ª Pod å†…å­˜æ³„æ¼

    **æ ¹å› **: Pod ä½¿ç”¨å†…å­˜æŒç»­å¢é•¿
    
    **è¯Šæ–­**:
    ```bash
    # ä½¿ç”¨ Prometheus æŸ¥è¯¢
    # topk(10, container_memory_usage_bytes{node="xxx"})
    ```
    
    **ä¿®å¤**: è®¾ç½®åˆç†çš„ memory limits

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æœ€å¤šçš„ Pod
    kubectl top pod -A --sort-by=memory | head -20
    
    # æ‰‹åŠ¨åˆ é™¤ä½ä¼˜å…ˆçº§ Pod é‡Šæ”¾èµ„æº
    kubectl delete pod <pod-name> -n <namespace>
    ```

  # ==========================================================================
  # L3: Service æ— åç«¯ (Endpoints ä¸ºç©º)
  # ==========================================================================
  service-no-endpoints.md: |
    # Service æ— åç«¯ (Endpoints ä¸ºç©º) è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L3` - æœåŠ¡ä¸ç½‘ç»œå±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: è®¿é—® Service æ— å“åº”ï¼ŒEndpoints ä¸ºç©º

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `no endpoints available`ã€`connection refused`ã€`Endpoints ä¸ºç©º`
    
    **å…¸å‹è¡¨ç°**:
    - è®¿é—® Service IP æ— å“åº”
    - `kubectl get endpoints <svc>` æ˜¾ç¤º `<none>`
    - æœåŠ¡å‘ç°å¤±è´¥

    ## é—®é¢˜åŸç†

    Service é€šè¿‡ **Selector** åŒ¹é… Podï¼Œè‡ªåŠ¨ç»´æŠ¤ Endpointsï¼š
    - Selector åŒ¹é…åˆ°çš„ Pod å¿…é¡»æ˜¯ **Running ä¸” Ready**
    - å¦‚æœæ²¡æœ‰ Pod åŒ¹é…ï¼ŒEndpoints ä¸ºç©º

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹ Service
    kubectl get svc <service-name> -n <namespace> -o wide
    
    # 2. æŸ¥çœ‹ Endpoints
    kubectl get endpoints <service-name> -n <namespace>
    
    # 3. æŸ¥çœ‹ Service çš„ Selector
    kubectl get svc <service-name> -n <namespace> -o jsonpath='{.spec.selector}'
    
    # 4. æŸ¥çœ‹åŒ¹é…çš„ Pod
    kubectl get pod -n <namespace> -l <key>=<value>
    
    # 5. æ£€æŸ¥ Pod æ˜¯å¦ Ready
    kubectl get pod -n <namespace> -l <key>=<value> -o wide
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: Selector ä¸åŒ¹é…

    **æ ¹å› **: Service çš„ selector ä¸ Pod çš„ labels ä¸ä¸€è‡´
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Service selector
    kubectl get svc <svc> -o jsonpath='{.spec.selector}'
    
    # æŸ¥çœ‹ Pod labels
    kubectl get pod <pod> -o jsonpath='{.metadata.labels}'
    ```
    
    **ä¿®å¤**: ä¿®æ­£ Service selector æˆ– Pod labels

    ### åœºæ™¯ 2: Pod æœª Ready

    **æ ¹å› **: Pod æ­£åœ¨è¿è¡Œï¼Œä½† readinessProbe å¤±è´¥
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod -n <namespace> -l <selector>
    # æŸ¥çœ‹ READY åˆ—æ˜¯å¦ä¸º 0/1
    ```
    
    **ä¿®å¤**: å‚è€ƒ pod-not-ready.md

    ### åœºæ™¯ 3: Pod ä¸å­˜åœ¨

    **æ ¹å› **: æ²¡æœ‰ Pod è¿è¡Œ
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod -n <namespace> -l <selector>
    kubectl get deployment -n <namespace>
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ Deployment å‰¯æœ¬æ•°ï¼Œç¡®ä¿ Pod è¿è¡Œ

    ### åœºæ™¯ 4: å‘½åç©ºé—´é”™è¯¯

    **æ ¹å› **: Service å’Œ Pod ä¸åœ¨åŒä¸€å‘½åç©ºé—´
    
    **è¯´æ˜**: Service åªèƒ½é€‰æ‹©åŒä¸€å‘½åç©ºé—´çš„ Pod

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Service è¯¦æƒ…
    kubectl describe svc <service-name> -n <namespace>
    
    # æµ‹è¯• Service è¿é€šæ€§
    kubectl run test --rm -it --image=busybox -- wget -O- <service-name>.<namespace>:<port>
    ```

  # ==========================================================================
  # L3: DNS è§£æå¤±è´¥
  # ==========================================================================
  dns-resolution-failed.md: |
    # DNS è§£æå¤±è´¥è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L3` - æœåŠ¡ä¸ç½‘ç»œå±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å†… DNS è§£æå¤±è´¥

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `NXDOMAIN`ã€`no such host`ã€`DNS resolution failed`
    
    **å…¸å‹è¡¨ç°**:
    - åº”ç”¨æ— æ³•è§£ææœåŠ¡å
    - `nslookup` å¤±è´¥
    - è¿æ¥è¶…æ—¶ï¼ˆDNS å¼•èµ·ï¼‰

    ## é—®é¢˜åŸç†

    K8s DNS è§£ææµç¨‹ï¼š
    1. Pod ä½¿ç”¨ `/etc/resolv.conf` ä¸­çš„ DNS æœåŠ¡å™¨
    2. é»˜è®¤æŒ‡å‘ CoreDNS Serviceï¼ˆkube-dnsï¼‰
    3. CoreDNS è§£æé›†ç¾¤å†…æœåŠ¡åï¼ˆxxx.namespace.svc.cluster.localï¼‰
    4. å¤–éƒ¨åŸŸåè½¬å‘åˆ°ä¸Šæ¸¸ DNS

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æ£€æŸ¥ CoreDNS æ˜¯å¦æ­£å¸¸
    kubectl get pod -n kube-system -l k8s-app=kube-dns
    
    # 2. æŸ¥çœ‹ CoreDNS æ—¥å¿—
    kubectl logs -n kube-system -l k8s-app=kube-dns --tail=100
    
    # 3. æ£€æŸ¥ kube-dns Service
    kubectl get svc -n kube-system kube-dns
    
    # 4. åœ¨ Pod å†…æµ‹è¯• DNS
    kubectl exec <pod> -- nslookup kubernetes.default
    kubectl exec <pod> -- cat /etc/resolv.conf
    
    # 5. æµ‹è¯•å¤–éƒ¨ DNS
    kubectl exec <pod> -- nslookup google.com
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: CoreDNS Pod å¼‚å¸¸

    **æ ¹å› **: CoreDNS Pod å´©æºƒæˆ–æœªè¿è¡Œ
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod -n kube-system -l k8s-app=kube-dns
    kubectl describe pod -n kube-system -l k8s-app=kube-dns
    ```
    
    **ä¿®å¤**:
    ```bash
    kubectl rollout restart deployment/coredns -n kube-system
    ```

    ### åœºæ™¯ 2: æœåŠ¡åæ‹¼å†™é”™è¯¯

    **æ ¹å› **: æœåŠ¡åæ ¼å¼é”™è¯¯
    
    **æ­£ç¡®æ ¼å¼**:
    - åŒå‘½åç©ºé—´: `<service-name>`
    - è·¨å‘½åç©ºé—´: `<service-name>.<namespace>`
    - å®Œæ•´æ ¼å¼: `<service-name>.<namespace>.svc.cluster.local`
    
    **è¯Šæ–­**:
    ```bash
    kubectl get svc -A | grep <service-name>
    ```

    ### åœºæ™¯ 3: Pod DNS é…ç½®é”™è¯¯

    **æ ¹å› **: Pod çš„ dnsPolicy é…ç½®ä¸å½“
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod <pod> -o jsonpath='{.spec.dnsPolicy}'
    kubectl exec <pod> -- cat /etc/resolv.conf
    ```
    
    **å¸¸è§ dnsPolicy**:
    - `ClusterFirst`: é»˜è®¤ï¼Œä¼˜å…ˆä½¿ç”¨é›†ç¾¤ DNS
    - `Default`: ä½¿ç”¨èŠ‚ç‚¹çš„ DNS
    - `None`: éœ€è¦æ‰‹åŠ¨é…ç½® dnsConfig

    ### åœºæ™¯ 4: ç½‘ç»œç­–ç•¥é˜»æ–­ DNS

    **æ ¹å› **: NetworkPolicy é˜»æ­¢äº†åˆ° CoreDNS çš„æµé‡
    
    **è¯Šæ–­**:
    ```bash
    kubectl get networkpolicy -n <namespace>
    ```
    
    **ä¿®å¤**: æ·»åŠ å…è®¸ DNS æµé‡çš„è§„åˆ™

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # é‡å¯ CoreDNS
    kubectl rollout restart deployment/coredns -n kube-system
    
    # æµ‹è¯• DNS
    kubectl run dns-test --rm -it --image=busybox -- nslookup kubernetes.default
    
    # æŸ¥çœ‹ CoreDNS é…ç½®
    kubectl get configmap coredns -n kube-system -o yaml
    ```

  # ==========================================================================
  # L3: ç½‘ç»œè¿é€šæ€§é—®é¢˜
  # ==========================================================================
  network-connectivity.md: |
    # ç½‘ç»œè¿é€šæ€§é—®é¢˜è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L3` - æœåŠ¡ä¸ç½‘ç»œå±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod é—´æ— æ³•é€šä¿¡ã€è·¨èŠ‚ç‚¹ç½‘ç»œä¸é€š

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `connection refused`ã€`timeout`ã€`no route to host`
    
    **å…¸å‹è¡¨ç°**:
    - Pod é—´æ— æ³• ping é€š
    - è·¨èŠ‚ç‚¹é€šä¿¡å¤±è´¥
    - åŒèŠ‚ç‚¹é€šä¿¡æ­£å¸¸ï¼Œè·¨èŠ‚ç‚¹å¤±è´¥

    ## é—®é¢˜åŸç†

    K8s ç½‘ç»œæ¨¡å‹ï¼š
    1. æ¯ä¸ª Pod æœ‰ç‹¬ç«‹ IP
    2. Pod é—´å¯ä»¥ç›´æ¥é€šä¿¡ï¼ˆä¸éœ€è¦ NATï¼‰
    3. ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰è´Ÿè´£å®ç°

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. è·å– Pod IP
    kubectl get pod -o wide
    
    # 2. ä» Pod A æµ‹è¯•åˆ° Pod B
    kubectl exec <pod-a> -- ping <pod-b-ip>
    kubectl exec <pod-a> -- nc -zv <pod-b-ip> <port>
    
    # 3. æ£€æŸ¥ NetworkPolicy
    kubectl get networkpolicy -n <namespace>
    
    # 4. æ£€æŸ¥ CNI æ’ä»¶çŠ¶æ€ï¼ˆä»¥ Calico ä¸ºä¾‹ï¼‰
    kubectl get pod -n kube-system -l k8s-app=calico-node
    
    # 5. æ£€æŸ¥èŠ‚ç‚¹é—´ç½‘ç»œ
    # åœ¨èŠ‚ç‚¹ A ä¸Š ping èŠ‚ç‚¹ B çš„ Pod ç½‘æ®µ
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: NetworkPolicy é˜»æ–­

    **æ ¹å› **: å­˜åœ¨ NetworkPolicy é™åˆ¶äº† ingress/egress
    
    **è¯Šæ–­**:
    ```bash
    kubectl get networkpolicy -n <namespace>
    kubectl describe networkpolicy <policy-name> -n <namespace>
    ```
    
    **ä¿®å¤**: è°ƒæ•´ NetworkPolicy è§„åˆ™

    ### åœºæ™¯ 2: CNI æ’ä»¶å¼‚å¸¸

    **æ ¹å› **: ç½‘ç»œæ’ä»¶ Pod æœªæ­£å¸¸è¿è¡Œ
    
    **è¯Šæ–­**:
    ```bash
    # Calico
    kubectl get pod -n kube-system -l k8s-app=calico-node
    
    # Flannel
    kubectl get pod -n kube-system -l app=flannel
    
    # Cilium
    kubectl get pod -n kube-system -l k8s-app=cilium
    ```
    
    **ä¿®å¤**: é‡å¯ CNI æ’ä»¶ Pod

    ### åœºæ™¯ 3: è·¨èŠ‚ç‚¹ç½‘ç»œé—®é¢˜

    **ç‰¹å¾**: åŒèŠ‚ç‚¹ Pod é€šä¿¡æ­£å¸¸ï¼Œè·¨èŠ‚ç‚¹å¤±è´¥
    
    **æ ¹å› **: èŠ‚ç‚¹é—´ç½‘ç»œéš§é“é—®é¢˜ï¼ˆVXLAN/IPIPï¼‰
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥éš§é“æ¥å£
    ip link show | grep -E "vxlan|tunl"
    
    # æ£€æŸ¥è·¯ç”±
    ip route
    ```

    ### åœºæ™¯ 4: kube-proxy é—®é¢˜

    **æ ¹å› **: Service IP æ— æ³•è®¿é—®
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod -n kube-system -l k8s-app=kube-proxy
    kubectl logs -n kube-system -l k8s-app=kube-proxy --tail=50
    
    # æ£€æŸ¥ iptables è§„åˆ™ï¼ˆiptables æ¨¡å¼ï¼‰
    iptables -t nat -L KUBE-SERVICES | head -20
    ```

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # é‡å¯ CNI æ’ä»¶
    kubectl rollout restart daemonset/calico-node -n kube-system
    
    # é‡å¯ kube-proxy
    kubectl rollout restart daemonset/kube-proxy -n kube-system
    
    # æµ‹è¯•è¿é€šæ€§
    kubectl run test --rm -it --image=busybox -- ping <target-ip>
    ```

  # ==========================================================================
  # L3: Ingress æ— æ³•è®¿é—®
  # ==========================================================================
  ingress-not-working.md: |
    # Ingress æ— æ³•è®¿é—®è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L3` - æœåŠ¡ä¸ç½‘ç»œå±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: é€šè¿‡ Ingress è®¿é—®æœåŠ¡å¤±è´¥

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `404`ã€`502`ã€`503`ã€`Ingress`
    
    **å…¸å‹è¡¨ç°**:
    - è®¿é—® Ingress è¿”å› 404/502/503
    - SSL è¯ä¹¦é”™è¯¯
    - åŸŸåæ— æ³•è§£æåˆ° Ingress

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹ Ingress
    kubectl get ingress -n <namespace>
    kubectl describe ingress <ingress-name> -n <namespace>
    
    # 2. æ£€æŸ¥ Ingress Controller
    kubectl get pod -n ingress-nginx
    kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller --tail=100
    
    # 3. æ£€æŸ¥åç«¯ Service
    kubectl get svc <backend-service> -n <namespace>
    kubectl get endpoints <backend-service> -n <namespace>
    
    # 4. æµ‹è¯•ç›´æ¥è®¿é—® Service
    kubectl port-forward svc/<service> 8080:80
    curl localhost:8080
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: è¿”å› 404

    **æ ¹å› **: è·¯å¾„è§„åˆ™ä¸åŒ¹é…æˆ–åç«¯ Service ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe ingress <ingress> | grep -A 10 Rules
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ path å’Œ pathType é…ç½®

    ### åœºæ™¯ 2: è¿”å› 502 Bad Gateway

    **æ ¹å› **: åç«¯ Service æ—  Endpoints æˆ– Pod æœª Ready
    
    **è¯Šæ–­**:
    ```bash
    kubectl get endpoints <backend-service> -n <namespace>
    ```
    
    **ä¿®å¤**: ç¡®ä¿åç«¯ Pod è¿è¡Œä¸” Ready

    ### åœºæ™¯ 3: è¿”å› 503 Service Unavailable

    **æ ¹å› **: Ingress Controller æ— æ³•è¿æ¥åç«¯
    
    **è¯Šæ–­**:
    ```bash
    kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller | grep <service-name>
    ```

    ### åœºæ™¯ 4: SSL è¯ä¹¦é”™è¯¯

    **æ ¹å› **: TLS Secret é…ç½®é”™è¯¯æˆ–è¯ä¹¦è¿‡æœŸ
    
    **è¯Šæ–­**:
    ```bash
    kubectl get secret <tls-secret> -n <namespace>
    kubectl get secret <tls-secret> -n <namespace> -o jsonpath='{.data.tls\.crt}' | base64 -d | openssl x509 -noout -dates
    ```

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # é‡å¯ Ingress Controller
    kubectl rollout restart deployment/ingress-nginx-controller -n ingress-nginx
    
    # æŸ¥çœ‹ Ingress é…ç½®
    kubectl get ingress <name> -n <namespace> -o yaml
    ```

  # ==========================================================================
  # L4: åº”ç”¨è¿æ¥è¢«æ‹’ç»
  # ==========================================================================
  app-connection-refused.md: |
    # åº”ç”¨è¿æ¥è¢«æ‹’ç»è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L4` - åº”ç”¨å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: åº”ç”¨æ— æ³•è¿æ¥æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ä¾èµ–æœåŠ¡

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `Connection refused`ã€`ECONNREFUSED`ã€`timeout`ã€`è¿æ¥è¶…æ—¶`
    
    **å…¸å‹è¡¨ç°**:
    - åº”ç”¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥å¤±è´¥
    - Redis/MQ è¿æ¥è¶…æ—¶
    - ç¬¬ä¸‰æ–¹ API è°ƒç”¨å¤±è´¥

    ## é—®é¢˜åŸç†

    åº”ç”¨è¿æ¥å¤±è´¥å¯èƒ½å‘ç”Ÿåœ¨å¤šä¸ªå±‚é¢ï¼š
    1. **DNS è§£æå¤±è´¥**: æ— æ³•è§£æç›®æ ‡åœ°å€
    2. **ç½‘ç»œä¸é€š**: é˜²ç«å¢™/NetworkPolicy é˜»æ–­
    3. **ç›®æ ‡æœåŠ¡ä¸å¯ç”¨**: æœåŠ¡æœªå¯åŠ¨æˆ–å¼‚å¸¸
    4. **è®¤è¯å¤±è´¥**: ç”¨æˆ·å/å¯†ç é”™è¯¯
    5. **è¿æ¥æ± è€—å°½**: è¿æ¥æ•°è¶…é™

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
    kubectl logs <pod> -n <namespace> | grep -i "connection\|refused\|timeout\|error"
    
    # 2. è¿›å…¥ Pod æµ‹è¯•ç½‘ç»œ
    kubectl exec -it <pod> -n <namespace> -- /bin/sh
    
    # 3. æµ‹è¯• DNS è§£æ
    kubectl exec <pod> -- nslookup <target-host>
    
    # 4. æµ‹è¯•ç«¯å£è¿é€šæ€§
    kubectl exec <pod> -- nc -zv <target-host> <port>
    
    # 5. æµ‹è¯• TCP è¿æ¥
    kubectl exec <pod> -- timeout 5 bash -c 'cat < /dev/tcp/<host>/<port>'
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: ç›®æ ‡æœåŠ¡æœªå¯åŠ¨

    **ç‰¹å¾**: `Connection refused`
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥ç›®æ ‡æœåŠ¡ Pod çŠ¶æ€
    kubectl get pod -n <namespace> -l app=<target-service>
    kubectl get endpoints <target-service>
    ```
    
    **ä¿®å¤**: ç¡®ä¿ç›®æ ‡æœåŠ¡æ­£å¸¸è¿è¡Œ

    ### åœºæ™¯ 2: ç½‘ç»œç­–ç•¥é˜»æ–­

    **ç‰¹å¾**: è¿æ¥è¶…æ—¶ï¼ˆé refusedï¼‰
    
    **è¯Šæ–­**:
    ```bash
    kubectl get networkpolicy -n <namespace>
    kubectl get networkpolicy -n <target-namespace>
    ```
    
    **ä¿®å¤**: æ·»åŠ å…è®¸é€šä¿¡çš„ NetworkPolicy è§„åˆ™

    ### åœºæ™¯ 3: è®¤è¯å¤±è´¥

    **ç‰¹å¾**: æ—¥å¿—æ˜¾ç¤º `Authentication failed`ã€`Access denied`
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥é…ç½®çš„å‡­æ®
    kubectl exec <pod> -- env | grep -i password
    kubectl get secret <secret-name> -o yaml
    ```
    
    **ä¿®å¤**: æ›´æ–°æ­£ç¡®çš„å‡­æ®

    ### åœºæ™¯ 4: è¿æ¥æ± è€—å°½

    **ç‰¹å¾**: å¶å‘æ€§è¿æ¥å¤±è´¥ï¼ŒéæŒç»­æ€§
    
    **æ ¹å› **: åº”ç”¨è¿æ¥æœªæ­£ç¡®é‡Šæ”¾ï¼Œæˆ–è¿æ¥æ± é…ç½®è¿‡å°
    
    **è¯Šæ–­**: æŸ¥çœ‹ç›®æ ‡æœåŠ¡çš„è¿æ¥æ•°
    ```bash
    # MySQL
    SHOW STATUS LIKE 'Threads_connected';
    
    # Redis
    INFO clients
    ```
    
    **ä¿®å¤**: è°ƒæ•´è¿æ¥æ± é…ç½®æˆ–æ’æŸ¥è¿æ¥æ³„æ¼

    ### åœºæ™¯ 5: DNS è§£æå¤±è´¥

    **ç‰¹å¾**: `no such host`ã€`NXDOMAIN`
    
    **ä¿®å¤**: å‚è€ƒ dns-resolution-failed.md

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æµ‹è¯•æ•°æ®åº“è¿æ¥
    kubectl run db-test --rm -it --image=mysql:5.7 -- mysql -h <host> -u <user> -p
    
    # æµ‹è¯• Redis è¿æ¥
    kubectl run redis-test --rm -it --image=redis -- redis-cli -h <host> ping
    
    # é‡å¯åº”ç”¨
    kubectl rollout restart deployment/<app> -n <namespace>
    ```

    ## è¯æ®æ¥æºæ˜ å°„

    | è¯æ® | æ¥æº | è¯´æ˜ |
    |------|------|------|
    | é”™è¯¯ç±»å‹ | `kubectl logs` | Connection refused/timeout |
    | ç½‘ç»œè¿é€š | `nc -zv` | ç«¯å£æ˜¯å¦å¯è¾¾ |
    | DNS è§£æ | `nslookup` | åŸŸåæ˜¯å¦å¯è§£æ |
    | ç›®æ ‡çŠ¶æ€ | `kubectl get endpoints` | æœåŠ¡æ˜¯å¦æœ‰åç«¯ |

  # ==========================================================================
  # L4: åº”ç”¨ 5xx é”™è¯¯
  # ==========================================================================
  app-5xx-errors.md: |
    # åº”ç”¨ 5xx é”™è¯¯è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L4` - åº”ç”¨å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: åº”ç”¨è¿”å› 500/502/503/504 ç­‰æœåŠ¡å™¨é”™è¯¯

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `500`ã€`502`ã€`503`ã€`504`ã€`Internal Server Error`
    
    **HTTP çŠ¶æ€ç å«ä¹‰**:
    | çŠ¶æ€ç  | å«ä¹‰ | å¸¸è§åŸå›  |
    |--------|------|---------|
    | 500 | Internal Server Error | åº”ç”¨ä»£ç å¼‚å¸¸ |
    | 502 | Bad Gateway | ä¸Šæ¸¸æœåŠ¡ä¸å¯ç”¨ |
    | 503 | Service Unavailable | æœåŠ¡è¿‡è½½/æœªå°±ç»ª |
    | 504 | Gateway Timeout | ä¸Šæ¸¸å“åº”è¶…æ—¶ |

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
    kubectl logs <pod> -n <namespace> --tail=200
    
    # 2. æœç´¢é”™è¯¯å…³é”®è¯
    kubectl logs <pod> -n <namespace> | grep -i "error\|exception\|panic\|fatal"
    
    # 3. æŸ¥çœ‹åº”ç”¨å¥åº·çŠ¶æ€
    kubectl exec <pod> -- curl -v http://localhost:<port>/healthz
    
    # 4. æŸ¥çœ‹ Pod èµ„æºä½¿ç”¨
    kubectl top pod <pod> -n <namespace>
    
    # 5. æ£€æŸ¥ Ingress/Gateway æ—¥å¿—
    kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller | grep <service>
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: 500 - åº”ç”¨ä»£ç å¼‚å¸¸

    **ç‰¹å¾**: æ—¥å¿—ä¸­æœ‰å¼‚å¸¸å †æ ˆï¼ˆException/Panic/Errorï¼‰
    
    **è¯Šæ–­**:
    ```bash
    kubectl logs <pod> | grep -A 20 "Exception\|Panic\|Error"
    ```
    
    **ä¿®å¤**:
    - åˆ†æå¼‚å¸¸å †æ ˆå®šä½ä»£ç é—®é¢˜
    - çŸ­æœŸï¼šé‡å¯ Pod
    - é•¿æœŸï¼šä¿®å¤ä»£ç 

    ### åœºæ™¯ 2: 502 - ä¸Šæ¸¸æœåŠ¡ä¸å¯ç”¨

    **ç‰¹å¾**: Ingress/Gateway è¿”å› 502
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥åç«¯ Service æ˜¯å¦æœ‰ Endpoints
    kubectl get endpoints <backend-service>
    
    # æ£€æŸ¥ Pod æ˜¯å¦ Ready
    kubectl get pod -l app=<backend>
    ```
    
    **ä¿®å¤**: ç¡®ä¿åç«¯ Pod è¿è¡Œä¸” Ready

    ### åœºæ™¯ 3: 503 - æœåŠ¡è¿‡è½½

    **ç‰¹å¾**: é«˜å¹¶å‘æ—¶å‡ºç° 503
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod èµ„æºä½¿ç”¨
    kubectl top pod -l app=<app>
    
    # æŸ¥çœ‹ HPA çŠ¶æ€
    kubectl get hpa
    ```
    
    **ä¿®å¤**:
    - å¢åŠ å‰¯æœ¬æ•°
    - é…ç½® HPA è‡ªåŠ¨æ‰©å®¹
    - ä¼˜åŒ–åº”ç”¨æ€§èƒ½

    ### åœºæ™¯ 4: 504 - å“åº”è¶…æ—¶

    **ç‰¹å¾**: è¯·æ±‚å¤„ç†æ—¶é—´è¿‡é•¿
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹æ…¢è¯·æ±‚æ—¥å¿—
    kubectl logs <pod> | grep -i "slow\|timeout"
    
    # æ£€æŸ¥ä¾èµ–æœåŠ¡å“åº”æ—¶é—´
    kubectl exec <pod> -- curl -w "@-" -o /dev/null -s http://<dependency>
    ```
    
    **ä¿®å¤**:
    - å¢åŠ è¶…æ—¶æ—¶é—´é…ç½®
    - ä¼˜åŒ–æ…¢æŸ¥è¯¢
    - æ£€æŸ¥ä¾èµ–æœåŠ¡æ€§èƒ½

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # é‡å¯åº”ç”¨
    kubectl rollout restart deployment/<app> -n <namespace>
    
    # ä¸´æ—¶æ‰©å®¹
    kubectl scale deployment/<app> --replicas=5 -n <namespace>
    
    # æŸ¥çœ‹å®æ—¶æ—¥å¿—
    kubectl logs -f <pod> -n <namespace>
    ```

  # ==========================================================================
  # L4: åº”ç”¨é…ç½®é”™è¯¯
  # ==========================================================================
  app-config-errors.md: |
    # åº”ç”¨é…ç½®é”™è¯¯è¯Šæ–­æ‰‹å†Œ

    > **å±‚çº§**: `L4` - åº”ç”¨å±‚
    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: ç¯å¢ƒå˜é‡ã€ConfigMapã€Secret é…ç½®é—®é¢˜

    ## æ•…éšœç‰¹å¾

    **å…³é”®è¯**: `config`ã€`environment`ã€`not found`ã€`undefined`
    
    **å…¸å‹è¡¨ç°**:
    - åº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤ºé…ç½®ç¼ºå¤±
    - è¿æ¥å­—ç¬¦ä¸²é”™è¯¯
    - åŠŸèƒ½å¼‚å¸¸ä½†ä»£ç æ­£ç¡®

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # 1. æŸ¥çœ‹ Pod ç¯å¢ƒå˜é‡
    kubectl exec <pod> -n <namespace> -- env | sort
    
    # 2. æŸ¥çœ‹ Pod é…ç½®çš„ ConfigMap/Secret
    kubectl get pod <pod> -n <namespace> -o jsonpath='{.spec.containers[*].envFrom}'
    kubectl get pod <pod> -n <namespace> -o jsonpath='{.spec.volumes}'
    
    # 3. æŸ¥çœ‹ ConfigMap å†…å®¹
    kubectl get configmap <name> -n <namespace> -o yaml
    
    # 4. æŸ¥çœ‹ Secret å†…å®¹ï¼ˆbase64 è§£ç ï¼‰
    kubectl get secret <name> -n <namespace> -o jsonpath='{.data.<key>}' | base64 -d
    
    # 5. æŸ¥çœ‹æŒ‚è½½çš„é…ç½®æ–‡ä»¶
    kubectl exec <pod> -- cat /path/to/config.yaml
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: ç¯å¢ƒå˜é‡ç¼ºå¤±

    **ç‰¹å¾**: æ—¥å¿—æ˜¾ç¤º `xxx is undefined` æˆ– `missing required config`
    
    **è¯Šæ–­**:
    ```bash
    kubectl exec <pod> -- env | grep <EXPECTED_VAR>
    ```
    
    **ä¿®å¤**:
    ```bash
    # åœ¨ Deployment ä¸­æ·»åŠ ç¯å¢ƒå˜é‡
    kubectl set env deployment/<name> <KEY>=<VALUE> -n <namespace>
    ```

    ### åœºæ™¯ 2: ConfigMap/Secret æœªæŒ‚è½½

    **ç‰¹å¾**: é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe pod <pod> | grep -A 10 Volumes
    kubectl exec <pod> -- ls -la /path/to/config/
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ Deployment çš„ volumes å’Œ volumeMounts é…ç½®

    ### åœºæ™¯ 3: ConfigMap/Secret æ›´æ–°åæœªç”Ÿæ•ˆ

    **æ ¹å› **: ç¯å¢ƒå˜é‡æ–¹å¼å¼•ç”¨çš„ ConfigMap/Secret æ›´æ–°åä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ
    
    **ä¿®å¤**:
    ```bash
    # é‡å¯ Pod ä½¿é…ç½®ç”Ÿæ•ˆ
    kubectl rollout restart deployment/<name> -n <namespace>
    ```

    ### åœºæ™¯ 4: é…ç½®å€¼æ ¼å¼é”™è¯¯

    **ç‰¹å¾**: è§£æé…ç½®å¤±è´¥ï¼Œå¦‚ JSON/YAML æ ¼å¼é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹é…ç½®å†…å®¹
    kubectl get configmap <name> -o yaml
    
    # éªŒè¯ JSON æ ¼å¼
    kubectl exec <pod> -- cat /path/config.json | jq .
    ```
    
    **ä¿®å¤**: æ›´æ–°æ­£ç¡®æ ¼å¼çš„é…ç½®

    ### åœºæ™¯ 5: æ•æ„Ÿä¿¡æ¯æ³„éœ²æ’æŸ¥

    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯æ”¾åœ¨ ConfigMap è€Œé Secret
    kubectl get configmap -o yaml | grep -i password
    ```

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æ›´æ–° ConfigMap
    kubectl create configmap <name> --from-file=<file> --dry-run=client -o yaml | kubectl apply -f -
    
    # æ›´æ–° Secret
    kubectl create secret generic <name> --from-literal=<key>=<value> --dry-run=client -o yaml | kubectl apply -f -
    
    # é‡å¯åº”ç”¨ä½¿é…ç½®ç”Ÿæ•ˆ
    kubectl rollout restart deployment/<name> -n <namespace>
    ```

    ## é…ç½®æœ€ä½³å®è·µ

    1. **æ•æ„Ÿä¿¡æ¯ç”¨ Secret**: å¯†ç ã€API Keyã€è¯ä¹¦
    2. **é…ç½®ç”¨ ConfigMap**: åº”ç”¨é…ç½®ã€ç¯å¢ƒè®¾ç½®
    3. **æ–‡ä»¶æŒ‚è½½ vs ç¯å¢ƒå˜é‡**:
       - æ–‡ä»¶æŒ‚è½½ï¼šæ”¯æŒçƒ­æ›´æ–°ï¼ˆä½†åº”ç”¨éœ€ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
       - ç¯å¢ƒå˜é‡ï¼šéœ€é‡å¯ Pod æ‰èƒ½æ›´æ–°

  # ==========================================================================
  # Helm ç®¡ç† Observability å¯è§‚æµ‹æ€§å¹³å°
  # ==========================================================================
  helm-observability-install.md: |
    # Helm ç®¡ç† Observability å¹³å°

    > **ç±»å‹**: `procedure`ï¼ˆæµç¨‹å‹ï¼‰
    > **åŒ…å«æ“ä½œ**: å®‰è£… | å‡çº§ | å¸è½½
    > **âš ï¸ æ ¹æ®ç”¨æˆ·æ„å›¾é€‰æ‹©å¯¹åº”æµç¨‹ï¼Œä¸è¦ä»å¤´æ‰§è¡Œï¼**

    ## â›” çº¦æŸ
    **ç¦æ­¢ä½¿ç”¨ `run_bash_command` æ‰§è¡Œ helm å‘½ä»¤ï¼Œå¿…é¡»ä½¿ç”¨ MCP å·¥å…·ï¼**

    ## ğŸ” å›ºå®šé…ç½®ï¼ˆç§æœ‰ Repoï¼‰
    | å‚æ•° | å€¼ |
    |------|-----|
    | repo_name | `observability` |
    | url | `http://192.168.1.63/api/v4/projects/65/packages/helm/stable` |
    | username | `wanghuhu` |
    | password | `glpat-n_ZsxoVt4HxN_ExHENy3` |
    | chart | `observability/observability` |

    ## ğŸ”„ åŠ¨æ€å‚æ•°ï¼ˆæ ¹æ®ç”¨æˆ·è¾“å…¥å†³å®šï¼‰
    | å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
    |------|--------|------|
    | release_name | `observability` | ç”¨æˆ·å¯æŒ‡å®šå…¶ä»–åç§° |
    | namespace | `xnet` | ç”¨æˆ·å¯æŒ‡å®šå…¶ä»–å‘½åç©ºé—´ |

    ---
    ---

    ## ğŸ“¦ æ“ä½œï¼šå®‰è£…ï¼ˆå½“ç”¨æˆ·è¯´"å®‰è£…"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **Step 1**: æ·»åŠ  Repo
    ```
    å·¥å…·: helm_repo_add
    å‚æ•°: name=observability, url=<å›ºå®šURL>, username=<å›ºå®š>, password=<å›ºå®š>
    ```

    **Step 2**: å®‰è£… Chart
    ```
    å·¥å…·: helm_install
    å‚æ•°: release_name=<åŠ¨æ€>, chart=observability/observability, namespace=<åŠ¨æ€>, create_namespace=true, wait=true
    ```

    ---
    ---

    ## ğŸ”„ æ“ä½œï¼šå‡çº§ï¼ˆå½“ç”¨æˆ·è¯´"å‡çº§/æ›´æ–°"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **Step 1**: æ›´æ–° Repo ç´¢å¼•
    ```
    å·¥å…·: helm_repo_update
    ```

    **Step 2**: å‡çº§ Release
    ```
    å·¥å…·: helm_upgrade
    å‚æ•°: release_name=<åŠ¨æ€>, chart=observability/observability, namespace=<åŠ¨æ€>, wait=true
    ```

    ---
    ---

    ## ğŸ—‘ï¸ æ“ä½œï¼šå¸è½½ï¼ˆå½“ç”¨æˆ·è¯´"å¸è½½/åˆ é™¤/ç§»é™¤"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **ä»…éœ€ 1 æ­¥**:
    ```
    å·¥å…·: helm_uninstall
    å‚æ•°: release_name=<åŠ¨æ€>, namespace=<åŠ¨æ€>
    ```

    ---
    ---

    ## âš ï¸ æ•…éšœæ’æŸ¥
    - ç½‘ç»œé—®é¢˜: æ£€æŸ¥ `192.168.1.63` æ˜¯å¦å¯è¾¾
    - éªŒè¯çŠ¶æ€: `kubectl get pods -n <namespace>`
