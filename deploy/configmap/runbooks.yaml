# Runbook çŸ¥è¯†åº“ ConfigMap
# åŸºäºé˜¿é‡Œäº‘ Pod å¼‚å¸¸é—®é¢˜æ’æŸ¥æ–‡æ¡£é‡æ„
# å‚è€ƒ: https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1

apiVersion: v1
kind: ConfigMap
metadata:
  name: aiops-runbooks
  namespace: aiops
data:
  catalog.json: |
    {
      "catalog": [
        {
          "id": "pod-quick-diagnosis",
          "type": "procedure",
          "update_date": "2025-12-25",
          "description": "ã€æµç¨‹å‹ã€‘Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­å…¥å£ - æ ¹æ® Pod çŠ¶æ€è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„è¯Šæ–­æ‰‹å†Œ",
          "link": "pod-quick-diagnosis.md",
          "operations": ["è¯Šæ–­", "æ’æŸ¥", "æ£€æŸ¥"]
        },
        {
          "id": "pod-pending",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘Pod è°ƒåº¦å¤±è´¥ (Pending) - èŠ‚ç‚¹èµ„æºä¸è¶³ã€äº²å’Œæ€§ã€æ±¡ç‚¹ã€PVC ç­‰é—®é¢˜",
          "link": "pod-pending.md"
        },
        {
          "id": "pod-image-pull-failed",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff/ErrImagePull) - é•œåƒåœ°å€ã€ç½‘ç»œã€è®¤è¯é—®é¢˜",
          "link": "pod-image-pull-failed.md"
        },
        {
          "id": "pod-crashloop-backoff",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff) - Exit Code è§£è¯»ã€OOMã€é…ç½®é”™è¯¯ã€ä¾èµ–é—®é¢˜",
          "link": "pod-crashloop-backoff.md"
        },
        {
          "id": "pod-not-ready",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘Pod æœªå°±ç»ª (Running ä½† 0/1 Ready) - å¥åº·æ£€æŸ¥å¤±è´¥ã€Readiness/Liveness Probe é…ç½®é—®é¢˜",
          "link": "pod-not-ready.md"
        },
        {
          "id": "pod-terminating",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘Pod åˆ é™¤å¡ä½ (Terminating) - Finalizer é˜»å¡ã€èŠ‚ç‚¹ä¸å¯è¾¾ã€å¼ºåˆ¶åˆ é™¤æ–¹æ³•",
          "link": "pod-terminating.md"
        },
        {
          "id": "pod-evicted",
          "type": "knowledge",
          "update_date": "2025-12-25",
          "description": "ã€çŸ¥è¯†å‹ã€‘Pod è¢«é©±é€ (Evicted) - èŠ‚ç‚¹èµ„æºå‹åŠ›ã€ephemeral-storage è¶…é™",
          "link": "pod-evicted.md"
        },
        {
          "id": "helm-observability-install",
          "type": "procedure",
          "update_date": "2025-12-16",
          "description": "ã€æµç¨‹å‹ã€‘Helm ç®¡ç† Observability å¹³å° - åŒ…å«ï¼šå®‰è£…ã€å‡çº§ã€å¸è½½ä¸‰ä¸ªç‹¬ç«‹æµç¨‹",
          "link": "helm-observability-install.md",
          "operations": ["å®‰è£…", "å‡çº§", "å¸è½½"]
        }
      ]
    }

  # ==========================================================================
  # Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­æµç¨‹ï¼ˆå…¥å£ï¼‰
  # ==========================================================================
  pod-quick-diagnosis.md: |
    # Pod å¼‚å¸¸å¿«é€Ÿè¯Šæ–­æµç¨‹

    > **ç±»å‹**: `procedure`ï¼ˆæµç¨‹å‹ï¼‰
    > **ç”¨é€”**: Pod å¼‚å¸¸è¯Šæ–­çš„ç»Ÿä¸€å…¥å£ï¼Œæ ¹æ®çŠ¶æ€è·¯ç”±åˆ°å…·ä½“æ‰‹å†Œ
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å¼‚å¸¸é—®é¢˜æ’æŸ¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## Step 1: è·å– Pod çŠ¶æ€

    ```bash
    kubectl get pod <pod-name> -n <namespace> -o wide
    ```

    æˆ–è€…æŸ¥æ‰¾å¼‚å¸¸ Podï¼š
    ```bash
    kubectl get pod -A | grep -v Running | grep -v Completed
    ```

    ## Step 2: æ ¹æ®çŠ¶æ€è·¯ç”±è¯Šæ–­

    | Pod çŠ¶æ€ | è¯´æ˜ | å¯¹åº”æ‰‹å†Œ |
    |---------|------|---------|
    | `Pending` | ç­‰å¾…è°ƒåº¦ | â†’ pod-pending.md |
    | `ImagePullBackOff` / `ErrImagePull` | é•œåƒæ‹‰å–å¤±è´¥ | â†’ pod-image-pull-failed.md |
    | `CrashLoopBackOff` / `Error` | å®¹å™¨å´©æºƒå¾ªç¯ | â†’ pod-crashloop-backoff.md |
    | `Running` (0/1 Ready) | å¥åº·æ£€æŸ¥å¤±è´¥ | â†’ pod-not-ready.md |
    | `Terminating` | åˆ é™¤å¡ä½ | â†’ pod-terminating.md |
    | `Evicted` | è¢«é©±é€ | â†’ pod-evicted.md |
    | `CreateContainerConfigError` | é…ç½®é”™è¯¯ | â†’ æ£€æŸ¥ ConfigMap/Secret |

    ## Step 3: è·å–è¯¦ç»†ä¿¡æ¯

    ```bash
    # æŸ¥çœ‹ Pod è¯¦æƒ…å’Œäº‹ä»¶
    kubectl describe pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹å®¹å™¨æ—¥å¿—
    kubectl logs <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ä¸Šæ¬¡å´©æºƒçš„æ—¥å¿—ï¼ˆå¦‚æœæ˜¯ CrashLoopBackOffï¼‰
    kubectl logs <pod-name> -n <namespace> --previous
    ```

    ## Step 4: æ‰§è¡Œå¯¹åº”æ‰‹å†Œ

    æ ¹æ® Step 2 è¯†åˆ«çš„çŠ¶æ€ï¼Œè°ƒç”¨ `fetch_runbook` è·å–å¯¹åº”æ‰‹å†Œå¹¶æ‰§è¡Œè¯Šæ–­ã€‚

  # ==========================================================================
  # Pod è°ƒåº¦å¤±è´¥ (Pending)
  # ==========================================================================
  pod-pending.md: |
    # Pod è°ƒåº¦å¤±è´¥ (Pending) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod é•¿æ—¶é—´å¤„äº Pending çŠ¶æ€ï¼Œæœªè¢«è°ƒåº¦åˆ°ä»»ä½•èŠ‚ç‚¹
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod è°ƒåº¦é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Pending`ã€`Unschedulable`ã€`FailedScheduling`
    
    **å…¸å‹äº‹ä»¶**:
    - `0/x nodes are available`
    - `Insufficient cpu/memory`
    - `node(s) didn't match node selector`
    - `node(s) had taint that the pod didn't tolerate`
    - `persistentvolumeclaim not found`

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆå…³é”®ï¼ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
    kubectl get nodes -o wide
    kubectl describe nodes | grep -A 5 "Allocated resources"
    
    # æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
    kubectl describe nodes | grep Taints
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: èŠ‚ç‚¹èµ„æºä¸è¶³
    
    **äº‹ä»¶**: `0/x nodes are available: x Insufficient cpu/memory`
    
    **æ ¹å› **: é›†ç¾¤ CPU æˆ–å†…å­˜èµ„æºå·²è€—å°½
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºåˆ†é…
    kubectl describe nodes | grep -A 10 "Allocated resources"
    ```
    
    **ä¿®å¤**:
    - åˆ é™¤ä¸å¿…è¦çš„ Pod é‡Šæ”¾èµ„æº
    - é™ä½ Pod çš„ requests å€¼
    - æ‰©å®¹èŠ‚ç‚¹

    ### åœºæ™¯ 2: èŠ‚ç‚¹é€‰æ‹©å™¨ä¸åŒ¹é…
    
    **äº‹ä»¶**: `node(s) didn't match node selector`
    
    **æ ¹å› **: Pod æŒ‡å®šäº† nodeSelectorï¼Œä½†æ²¡æœ‰èŠ‚ç‚¹å…·æœ‰è¯¥æ ‡ç­¾
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„ nodeSelector
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.nodeSelector}'
    
    # æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾
    kubectl get nodes --show-labels
    ```
    
    **ä¿®å¤**:
    - ä¸ºèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾ï¼š`kubectl label node <node> <key>=<value>`
    - æˆ–ä¿®æ”¹ Pod çš„ nodeSelector

    ### åœºæ™¯ 3: èŠ‚ç‚¹æ±¡ç‚¹ï¼ˆTaintï¼‰é—®é¢˜
    
    **äº‹ä»¶**: `node(s) had taint that the pod didn't tolerate`
    
    **æ ¹å› **: èŠ‚ç‚¹è®¾ç½®äº†æ±¡ç‚¹ï¼Œä½† Pod æ²¡æœ‰å¯¹åº”çš„å®¹å¿
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹
    kubectl describe nodes | grep Taints
    ```
    
    **ä¿®å¤**:
    - ä¸º Pod æ·»åŠ  toleration
    - æˆ–ç§»é™¤èŠ‚ç‚¹æ±¡ç‚¹ï¼š`kubectl taint nodes <node> <key>-`

    ### åœºæ™¯ 4: PVC æœªç»‘å®š
    
    **äº‹ä»¶**: `persistentvolumeclaim "xxx" not found` æˆ– `unbound PersistentVolumeClaim`
    
    **æ ¹å› **: Pod å¼•ç”¨çš„ PVC ä¸å­˜åœ¨æˆ–æœªç»‘å®š
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ PVC çŠ¶æ€
    kubectl get pvc -n <namespace>
    kubectl describe pvc <pvc-name> -n <namespace>
    ```
    
    **ä¿®å¤**:
    - åˆ›å»ºå¯¹åº”çš„ PVC
    - æˆ–æ£€æŸ¥ StorageClass æ˜¯å¦æ­£ç¡®

    ### åœºæ™¯ 5: èŠ‚ç‚¹å¤„äº NotReady çŠ¶æ€
    
    **äº‹ä»¶**: `no nodes available to schedule pods`
    
    **æ ¹å› **: æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤„äºä¸å¯ç”¨çŠ¶æ€
    
    **è¯Šæ–­**:
    ```bash
    kubectl get nodes
    kubectl describe node <node-name>
    ```
    
    **ä¿®å¤**: æ¢å¤èŠ‚ç‚¹çŠ¶æ€ï¼ˆæ£€æŸ¥ kubeletã€ç½‘ç»œç­‰ï¼‰

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod è°ƒåº¦å¤±è´¥çš„å…·ä½“åŸå› 
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    
    # å¦‚æœæ˜¯èµ„æºä¸è¶³ï¼ŒæŸ¥çœ‹å¯é‡Šæ”¾çš„èµ„æº
    kubectl get pod -A --sort-by='.status.startTime' | head -20
    
    # å¼ºåˆ¶é‡æ–°è°ƒåº¦ï¼ˆåˆ é™¤åè‡ªåŠ¨é‡å»ºï¼‰
    kubectl delete pod <pod-name> -n <namespace>
    ```

  # ==========================================================================
  # é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff)
  # ==========================================================================
  pod-image-pull-failed.md: |
    # é•œåƒæ‹‰å–å¤±è´¥ (ImagePullBackOff) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº ImagePullBackOff æˆ– ErrImagePull çŠ¶æ€
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘é•œåƒæ‹‰å–é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `ImagePullBackOff`ã€`ErrImagePull`ã€`ImageInspectError`
    
    **å…¸å‹äº‹ä»¶**:
    - `Failed to pull image`
    - `unauthorized: authentication required`
    - `manifest unknown`
    - `connection refused` / `timeout`

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆè·å–å…·ä½“é”™è¯¯ä¿¡æ¯ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Events
    
    # æŸ¥çœ‹ Pod ä½¿ç”¨çš„é•œåƒ
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].image}'
    
    # æŸ¥çœ‹ imagePullSecrets é…ç½®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.imagePullSecrets}'
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: é•œåƒåœ°å€é”™è¯¯
    
    **äº‹ä»¶**: `manifest unknown`ã€`not found`
    
    **æ ¹å› **: é•œåƒåç§°æˆ–æ ‡ç­¾ï¼ˆtagï¼‰ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥é•œåƒåœ°å€æ˜¯å¦æ­£ç¡®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].image}'
    ```
    
    **ä¿®å¤**:
    - ç¡®è®¤é•œåƒåç§°å’Œæ ‡ç­¾æ‹¼å†™æ­£ç¡®
    - ç¡®è®¤é•œåƒå·²æ¨é€åˆ°ä»“åº“
    - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ registry åœ°å€

    ### åœºæ™¯ 2: è®¤è¯å¤±è´¥ï¼ˆç§æœ‰ä»“åº“ï¼‰
    
    **äº‹ä»¶**: `unauthorized: authentication required`ã€`no basic auth credentials`
    
    **æ ¹å› **: ç§æœ‰é•œåƒä»“åº“éœ€è¦è®¤è¯ï¼Œä½†æœªé…ç½®æˆ–é…ç½®é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥ imagePullSecrets
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.imagePullSecrets}'
    
    # æ£€æŸ¥ Secret æ˜¯å¦å­˜åœ¨
    kubectl get secret -n <namespace>
    ```
    
    **ä¿®å¤**:
    ```bash
    # åˆ›å»º docker-registry ç±»å‹çš„ Secret
    kubectl create secret docker-registry <secret-name> \
      --docker-server=<registry-url> \
      --docker-username=<username> \
      --docker-password=<password> \
      -n <namespace>
    
    # åœ¨ Pod/Deployment ä¸­å¼•ç”¨
    # spec.imagePullSecrets:
    #   - name: <secret-name>
    ```

    ### åœºæ™¯ 3: ç½‘ç»œä¸é€š
    
    **äº‹ä»¶**: `connection refused`ã€`timeout`ã€`dial tcp: lookup xxx: no such host`
    
    **æ ¹å› **: èŠ‚ç‚¹æ— æ³•è®¿é—®é•œåƒä»“åº“
    
    **è¯Šæ–­**:
    ```bash
    # åœ¨èŠ‚ç‚¹ä¸Šæµ‹è¯•ç½‘ç»œè¿é€šæ€§
    kubectl run test-network --image=busybox --rm -it -- wget -O- <registry-url>
    
    # æ£€æŸ¥ DNS è§£æ
    kubectl run test-dns --image=busybox --rm -it -- nslookup <registry-host>
    ```
    
    **ä¿®å¤**:
    - æ£€æŸ¥ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰
    - æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
    - æ£€æŸ¥ DNS é…ç½®

    ### åœºæ™¯ 4: é•œåƒæ‹‰å–é€Ÿåº¦æ…¢
    
    **äº‹ä»¶**: é•¿æ—¶é—´å¤„äº `Pulling` çŠ¶æ€
    
    **æ ¹å› **: é•œåƒè¿‡å¤§æˆ–ç½‘ç»œå¸¦å®½ä¸è¶³
    
    **ä¿®å¤**:
    - ä½¿ç”¨é•œåƒåŠ é€Ÿå™¨
    - ä¼˜åŒ–é•œåƒå¤§å°ï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
    - é¢„æ‹‰å–é•œåƒåˆ°èŠ‚ç‚¹

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # æ‰‹åŠ¨åœ¨èŠ‚ç‚¹ä¸Šæ‹‰å–é•œåƒæµ‹è¯•
    crictl pull <image-url>
    
    # åˆ é™¤ Pod è§¦å‘é‡è¯•
    kubectl delete pod <pod-name> -n <namespace>
    
    # æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨ï¼ˆä½¿ç”¨ curlï¼‰
    curl -v https://<registry>/v2/<image>/manifests/<tag>
    ```

  # ==========================================================================
  # å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff)
  # ==========================================================================
  pod-crashloop-backoff.md: |
    # å®¹å™¨å´©æºƒå¾ªç¯ (CrashLoopBackOff) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº CrashLoopBackOff æˆ– Error çŠ¶æ€ï¼ŒRestart Count æŒç»­å¢åŠ 
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å¯åŠ¨å¤±è´¥æ’æŸ¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `CrashLoopBackOff`ã€`Error`ã€`Restart Count > 0`
    
    **å…¸å‹è¡¨ç°**:
    - Pod çŠ¶æ€åœ¨ Running å’Œ CrashLoopBackOff ä¹‹é—´åå¤åˆ‡æ¢
    - RESTARTS è®¡æ•°æŒç»­å¢åŠ 
    - æœåŠ¡æ— æ³•æ­£å¸¸æä¾›

    ## é—®é¢˜åŸç†
    
    Kubernetes æ£€æµ‹åˆ°å®¹å™¨é€€å‡ºåä¼šå°è¯•é‡å¯ã€‚å¦‚æœå®¹å™¨æŒç»­é€€å‡ºï¼Œkubelet ä¼šä½¿ç”¨**æŒ‡æ•°é€€é¿**ç­–ç•¥ï¼š
    
    **é€€é¿æ—¶é—´**: 10s â†’ 20s â†’ 40s â†’ 80s â†’ ... â†’ æœ€å¤§ 5 åˆ†é’Ÿ

    ## è¯Šæ–­å‘½ä»¤ï¼ˆæ ¸å¿ƒï¼‰

    ```bash
    # 1. è·å– Pod çŠ¶æ€å’Œ Exit Code
    kubectl describe pod <pod-name> -n <namespace> | grep -A 5 "Last State"
    
    # 2. è·å–å´©æºƒå‰çš„æ—¥å¿—ï¼ˆæœ€é‡è¦ï¼ï¼‰
    kubectl logs <pod-name> -n <namespace> --previous
    
    # 3. æŸ¥çœ‹ Pod äº‹ä»¶
    kubectl describe pod <pod-name> -n <namespace> | grep -A 20 Events
    ```

    ## Exit Code çŸ¥è¯†åº“

    | Exit Code | ä¿¡å· | å«ä¹‰ | å…¸å‹åœºæ™¯ |
    |-----------|------|------|---------|
    | 0 | - | æ­£å¸¸é€€å‡º | ä¸€æ¬¡æ€§ä»»åŠ¡å®Œæˆã€å¯åŠ¨å‘½ä»¤ç«‹å³é€€å‡º |
    | 1 | - | åº”ç”¨é”™è¯¯ | é…ç½®é”™è¯¯ã€ä¾èµ–ç¼ºå¤±ã€ä»£ç å¼‚å¸¸ |
    | 126 | - | æ— æ‰§è¡Œæƒé™ | è„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™ |
    | 127 | - | å‘½ä»¤ä¸å­˜åœ¨ | command é…ç½®é”™è¯¯ã€é•œåƒç¼ºå°‘ä¾èµ– |
    | 137 | SIGKILL(9) | **OOMKilled** | å†…å­˜è¶…é™è¢«ç³»ç»Ÿæ€æ­» |
    | 139 | SIGSEGV(11) | æ®µé”™è¯¯ | åº”ç”¨è®¿é—®éæ³•å†…å­˜ |
    | 143 | SIGTERM(15) | ä¼˜é›…ç»ˆæ­¢ | è¢« K8s ä¸»åŠ¨ç»ˆæ­¢ã€å¥åº·æ£€æŸ¥å¤±è´¥ |

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: OOMKilled (Exit Code 137) - å†…å­˜æº¢å‡º
    
    **äº‹ä»¶**: `Last State: Terminated, Reason: OOMKilled`
    
    **æ ¹å› **:
    - memory limit è®¾ç½®è¿‡ä½
    - åº”ç”¨å­˜åœ¨å†…å­˜æ³„æ¼
    - JVM -Xmx é…ç½®ä¸å½“
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹å®¹å™¨å†…å­˜é™åˆ¶
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].resources}'
    ```
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ å†…å­˜é™åˆ¶
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","resources":{"limits":{"memory":"1Gi"}}}]}}}}'
    ```

    ### åœºæ™¯ 2: åº”ç”¨é…ç½®é”™è¯¯ (Exit Code 1)
    
    **ç‰¹å¾**: æ—¥å¿—ä¸­æœ‰æ˜ç¡®çš„é…ç½®ç›¸å…³é”™è¯¯
    
    **æ ¹å› **:
    - ç¯å¢ƒå˜é‡ç¼ºå¤±æˆ–é”™è¯¯
    - ConfigMap/Secret é…ç½®é”™è¯¯
    - æ•°æ®åº“è¿æ¥ä¸²é”™è¯¯
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹å´©æºƒå‰æ—¥å¿—
    kubectl logs <pod-name> -n <namespace> --previous | tail -50
    
    # æ£€æŸ¥ç¯å¢ƒå˜é‡
    kubectl exec <pod-name> -n <namespace> -- env
    ```
    
    **ä¿®å¤**: ä¿®æ­£é…ç½®åé‡å¯
    ```bash
    kubectl rollout restart deployment <deploy-name> -n <namespace>
    ```

    ### åœºæ™¯ 3: å¯åŠ¨å‘½ä»¤é”™è¯¯ (Exit Code 0/127)
    
    **ç‰¹å¾**: Pod å¯åŠ¨åç«‹å³é€€å‡ºï¼Œæ—¥å¿—å¾ˆå°‘æˆ–æ²¡æœ‰
    
    **æ ¹å› **:
    - command/args é…ç½®é”™è¯¯
    - å…¥å£ç‚¹è„šæœ¬ç«‹å³é€€å‡º
    - é•œåƒä¸­ç¼ºå°‘æŒ‡å®šçš„å‘½ä»¤
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„å¯åŠ¨å‘½ä»¤
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].command}'
    ```
    
    **ä¿®å¤**: ä¿®æ­£ command é…ç½®

    ### åœºæ™¯ 4: ä¾èµ–æœåŠ¡ä¸å¯ç”¨ (Exit Code 1)
    
    **ç‰¹å¾**: æ—¥å¿—ä¸­æœ‰ `connection refused`ã€`timeout`ã€`ECONNREFUSED`
    
    **æ ¹å› **:
    - ä¾èµ–çš„æ•°æ®åº“ã€ç¼“å­˜ã€API ä¸å¯ç”¨
    - DNS è§£æå¤±è´¥
    - ç½‘ç»œç­–ç•¥é˜»æ­¢è®¿é—®
    
    **è¯Šæ–­**:
    ```bash
    # æ£€æŸ¥ä¾èµ–æœåŠ¡æ˜¯å¦å¯è¾¾
    kubectl exec <pod-name> -n <namespace> -- nc -zv <service-host> <port>
    ```
    
    **ä¿®å¤**: ç¡®ä¿ä¾èµ–æœåŠ¡å¯ç”¨

    ### åœºæ™¯ 5: å¥åº·æ£€æŸ¥è¿‡ä¸¥ (Exit Code 143)
    
    **ç‰¹å¾**: åº”ç”¨æ—¥å¿—æ­£å¸¸ï¼Œä½†è¢«é¢‘ç¹é‡å¯
    
    **æ ¹å› **:
    - livenessProbe è¶…æ—¶æ—¶é—´å¤ªçŸ­
    - initialDelaySeconds ä¸è¶³
    
    **ä¿®å¤**:
    ```bash
    # æ”¾å®½ livenessProbe
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","livenessProbe":{"initialDelaySeconds":60,"timeoutSeconds":10,"failureThreshold":5}}]}}}}'
    ```

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # åˆ é™¤ Pod è§¦å‘é‡å»º
    kubectl delete pod <pod-name> -n <namespace>
    
    # é‡å¯ Deployment
    kubectl rollout restart deployment <deploy-name> -n <namespace>
    
    # ä¸´æ—¶ç¦ç”¨å¥åº·æ£€æŸ¥è°ƒè¯•ï¼ˆå±é™©ï¼ä»…ç”¨äºè°ƒè¯•ï¼‰
    kubectl patch deployment <deploy-name> -n <namespace> --type='json' -p='[{"op":"remove","path":"/spec/template/spec/containers/0/livenessProbe"}]'
    ```

  # ==========================================================================
  # Pod æœªå°±ç»ª (Running ä½† 0/1 Ready)
  # ==========================================================================
  pod-not-ready.md: |
    # Pod æœªå°±ç»ª (Running ä½† 0/1 Ready) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod çŠ¶æ€ä¸º Runningï¼Œä½† READY åˆ—æ˜¾ç¤º 0/1ï¼ŒService æ— æ³•è·¯ç”±æµé‡
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod å°±ç»ªæ£€æŸ¥å¤±è´¥](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Running (0/1 Ready)`ã€`Readiness probe failed`
    
    **å…¸å‹è¡¨ç°**:
    - Pod çŠ¶æ€æ˜¾ç¤º Runningï¼Œä½† READY åˆ—ä¸º `0/1`
    - Service Endpoints ä¸ºç©ºï¼Œæ— æ³•è®¿é—®æœåŠ¡
    - Pod äº‹ä»¶æ˜¾ç¤º `Readiness probe failed`

    ## é—®é¢˜åŸç†
    
    Kubernetes ä½¿ç”¨ **readinessProbe** åˆ¤æ–­ Pod æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚
    å¦‚æœ readinessProbe å¤±è´¥ï¼ŒPod ä¸ä¼šè¢«åŠ å…¥ Service çš„ Endpoints åˆ—è¡¨ã€‚

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod å°±ç»ªçŠ¶æ€
    kubectl get pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ Pod äº‹ä»¶ï¼ˆå…³é”®ï¼ï¼‰
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Events
    
    # æŸ¥çœ‹ readinessProbe é…ç½®
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].readinessProbe}'
    
    # æ£€æŸ¥ Service Endpoints
    kubectl get endpoints <service-name> -n <namespace>
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: å¥åº·æ£€æŸ¥è·¯å¾„é”™è¯¯
    
    **äº‹ä»¶**: `Readiness probe failed: HTTP probe failed with statuscode: 404`
    
    **æ ¹å› **: readinessProbe é…ç½®çš„ HTTP è·¯å¾„ä¸å­˜åœ¨
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹é…ç½®çš„å¥åº·æ£€æŸ¥è·¯å¾„
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].readinessProbe.httpGet}'
    
    # æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
    kubectl exec <pod-name> -n <namespace> -- curl -v http://localhost:<port>/<path>
    ```
    
    **ä¿®å¤**: ä¿®æ­£ readinessProbe çš„ path å’Œ port

    ### åœºæ™¯ 2: åº”ç”¨å¯åŠ¨æ…¢
    
    **äº‹ä»¶**: å¥åº·æ£€æŸ¥åœ¨åº”ç”¨å®Œå…¨å¯åŠ¨å‰å°±å¼€å§‹æ£€æµ‹
    
    **æ ¹å› **: initialDelaySeconds è®¾ç½®è¿‡çŸ­
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ åˆå§‹å»¶è¿Ÿ
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","readinessProbe":{"initialDelaySeconds":30}}]}}}}'
    ```

    ### åœºæ™¯ 3: å¥åº·æ£€æŸ¥è¶…æ—¶
    
    **äº‹ä»¶**: `Readiness probe failed: context deadline exceeded`
    
    **æ ¹å› **: åº”ç”¨å“åº”å¤ªæ…¢ï¼Œè¶…è¿‡äº† timeoutSeconds
    
    **ä¿®å¤**: å¢åŠ  timeoutSeconds

    ### åœºæ™¯ 4: åº”ç”¨çœŸçš„æœ‰é—®é¢˜
    
    **ç‰¹å¾**: å¥åº·æ£€æŸ¥è¿”å›é 2xx çŠ¶æ€ç 
    
    **è¯Šæ–­**:
    ```bash
    # è¿›å…¥å®¹å™¨è°ƒè¯•
    kubectl exec -it <pod-name> -n <namespace> -- /bin/sh
    
    # æ‰‹åŠ¨æ£€æŸ¥å¥åº·æ¥å£
    curl -v http://localhost:<port>/healthz
    ```
    
    **ä¿®å¤**: æ’æŸ¥åº”ç”¨æœ¬èº«çš„é—®é¢˜

    ## ğŸ”§ é€šç”¨ä¿®å¤å‘½ä»¤

    ```bash
    # ä¸´æ—¶ç§»é™¤ readinessProbeï¼ˆç”¨äºè°ƒè¯•ï¼‰
    kubectl patch deployment <deploy-name> -n <namespace> --type='json' \
      -p='[{"op":"remove","path":"/spec/template/spec/containers/0/readinessProbe"}]'
    
    # æ”¾å®½å¥åº·æ£€æŸ¥é…ç½®
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","readinessProbe":{"initialDelaySeconds":60,"timeoutSeconds":10,"periodSeconds":10,"failureThreshold":6}}]}}}}'
    ```

  # ==========================================================================
  # Pod åˆ é™¤å¡ä½ (Terminating)
  # ==========================================================================
  pod-terminating.md: |
    # Pod åˆ é™¤å¡ä½ (Terminating) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod å¤„äº Terminating çŠ¶æ€ï¼Œæ— æ³•æ­£å¸¸åˆ é™¤
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod Terminating é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Terminating`ã€æ— æ³•åˆ é™¤
    
    **å…¸å‹è¡¨ç°**:
    - æ‰§è¡Œ `kubectl delete pod` åï¼ŒPod é•¿æ—¶é—´å¤„äº Terminating çŠ¶æ€
    - è¶…è¿‡ terminationGracePeriodSeconds ä»æœªåˆ é™¤

    ## é—®é¢˜åŸç†
    
    Pod åˆ é™¤æµç¨‹ï¼š
    1. K8s å‘é€ SIGTERM ä¿¡å·ç»™å®¹å™¨
    2. ç­‰å¾… terminationGracePeriodSecondsï¼ˆé»˜è®¤ 30sï¼‰
    3. å‘é€ SIGKILL å¼ºåˆ¶ç»ˆæ­¢
    4. æ¸…ç†èµ„æºã€ç§»é™¤ Finalizers
    5. ä» etcd ä¸­åˆ é™¤ Pod å¯¹è±¡

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥çœ‹ Pod çŠ¶æ€
    kubectl get pod <pod-name> -n <namespace>
    
    # æŸ¥çœ‹ Pod è¯¦æƒ…ï¼ˆå…³æ³¨ Finalizersï¼‰
    kubectl get pod <pod-name> -n <namespace> -o yaml | grep -A 5 finalizers
    
    # æŸ¥çœ‹ Pod æ‰€åœ¨èŠ‚ç‚¹
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.nodeName}'
    
    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: Finalizer é˜»å¡
    
    **ç‰¹å¾**: Pod æœ‰ Finalizersï¼Œç­‰å¾…æŸäº›èµ„æºæ¸…ç†
    
    **è¯Šæ–­**:
    ```bash
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.metadata.finalizers}'
    ```
    
    **ä¿®å¤**: ç§»é™¤ Finalizersï¼ˆè°¨æ…æ“ä½œï¼‰
    ```bash
    kubectl patch pod <pod-name> -n <namespace> -p '{"metadata":{"finalizers":null}}'
    ```

    ### åœºæ™¯ 2: èŠ‚ç‚¹ä¸å¯è¾¾
    
    **ç‰¹å¾**: Pod æ‰€åœ¨èŠ‚ç‚¹å¤„äº NotReady çŠ¶æ€
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod æ‰€åœ¨èŠ‚ç‚¹
    kubectl get pod <pod-name> -n <namespace> -o wide
    
    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    kubectl get nodes
    ```
    
    **ä¿®å¤**: æ¢å¤èŠ‚ç‚¹ï¼Œæˆ–å¼ºåˆ¶åˆ é™¤ Pod
    ```bash
    kubectl delete pod <pod-name> -n <namespace> --force --grace-period=0
    ```

    ### åœºæ™¯ 3: åº”ç”¨æ— æ³•ä¼˜é›…å…³é—­
    
    **ç‰¹å¾**: åº”ç”¨ä¸å“åº” SIGTERM ä¿¡å·
    
    **æ ¹å› **: åº”ç”¨æ²¡æœ‰å®ç°ä¼˜é›…å…³é—­é€»è¾‘
    
    **ä¿®å¤**:
    - çŸ­æœŸï¼šå¼ºåˆ¶åˆ é™¤ Pod
    - é•¿æœŸï¼šåº”ç”¨å®ç° SIGTERM å¤„ç†

    ### åœºæ™¯ 4: æŒ‚è½½çš„ Volume å¸è½½å¤±è´¥
    
    **ç‰¹å¾**: Pod ä½¿ç”¨äº† PVCï¼Œä½† Volume æ— æ³•å¸è½½
    
    **è¯Šæ–­**:
    ```bash
    kubectl describe pod <pod-name> -n <namespace> | grep -A 10 Volumes
    ```
    
    **ä¿®å¤**: æ£€æŸ¥ PV/PVC çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ¸…ç†

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # å¼ºåˆ¶åˆ é™¤ Podï¼ˆå¸¸ç”¨ï¼‰
    kubectl delete pod <pod-name> -n <namespace> --force --grace-period=0
    
    # ç§»é™¤ Finalizersï¼ˆå¦‚æœè¢« Finalizer é˜»å¡ï¼‰
    kubectl patch pod <pod-name> -n <namespace> -p '{"metadata":{"finalizers":null}}'
    
    # æ‰¹é‡å¼ºåˆ¶åˆ é™¤ Terminating çš„ Pod
    kubectl get pod -n <namespace> | grep Terminating | awk '{print $1}' | xargs -I {} kubectl delete pod {} -n <namespace> --force --grace-period=0
    ```

    ## âš ï¸ é£é™©æç¤º
    
    - å¼ºåˆ¶åˆ é™¤å¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼ï¼ˆå¦‚ Volume æœªæ­£å¸¸å¸è½½ï¼‰
    - Finalizers å­˜åœ¨æ˜¯æœ‰åŸå› çš„ï¼Œç§»é™¤å‰è¦ç¡®è®¤å½±å“
    - èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼ŒPod æ•°æ®å¯èƒ½ä¸¢å¤±

  # ==========================================================================
  # Pod è¢«é©±é€ (Evicted)
  # ==========================================================================
  pod-evicted.md: |
    # Pod è¢«é©±é€ (Evicted) è¯Šæ–­æ‰‹å†Œ

    > **ç±»å‹**: `knowledge`ï¼ˆçŸ¥è¯†å‹ï¼‰
    > **é€‚ç”¨åœºæ™¯**: Pod çŠ¶æ€ä¸º Evictedï¼Œè¢«èŠ‚ç‚¹é©±é€
    > **å‚è€ƒ**: [é˜¿é‡Œäº‘ Pod é©±é€é—®é¢˜](https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/pod-troubleshooting-1)

    ## æ•…éšœç‰¹å¾
    
    **çŠ¶æ€å…³é”®è¯**: `Evicted`ã€`The node was low on resource`
    
    **å…¸å‹äº‹ä»¶**:
    - `The node was low on resource: ephemeral-storage`
    - `The node was low on resource: memory`
    - `Pod ephemeral local storage usage exceeds the total limit`

    ## é—®é¢˜åŸç†
    
    å½“èŠ‚ç‚¹èµ„æºç´§å¼ æ—¶ï¼Œkubelet ä¼š**é©±é€**ä½ä¼˜å…ˆçº§ Pod ä»¥é‡Šæ”¾èµ„æºï¼š
    
    **é©±é€è§¦å‘æ¡ä»¶**:
    - å†…å­˜å‹åŠ›ï¼ˆmemory.available < 100Miï¼‰
    - ç£ç›˜å‹åŠ›ï¼ˆnodefs.available < 10%ï¼‰
    - ephemeral-storage è¶…é™

    ## è¯Šæ–­å‘½ä»¤

    ```bash
    # æŸ¥æ‰¾è¢«é©±é€çš„ Pod
    kubectl get pod -A | grep Evicted
    
    # æŸ¥çœ‹é©±é€åŸå› 
    kubectl describe pod <evicted-pod> -n <namespace> | grep -A 5 Status
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºå‹åŠ›
    kubectl describe nodes | grep -A 10 Conditions
    ```

    ## å¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

    ### åœºæ™¯ 1: ephemeral-storage è¶…é™ï¼ˆæœ€å¸¸è§ï¼‰
    
    **äº‹ä»¶**: `Pod ephemeral local storage usage exceeds the total limit`
    
    **æ ¹å› **: å®¹å™¨å†™å…¥çš„æ•°æ®è¶…è¿‡äº† limits.ephemeral-storage é™åˆ¶
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹ Pod çš„ ephemeral-storage é™åˆ¶
    kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.spec.containers[*].resources.limits}'
    ```
    
    **ä¿®å¤**:
    ```bash
    # å¢åŠ  ephemeral-storage é™åˆ¶
    kubectl patch deployment <deploy-name> -n <namespace> -p \
      '{"spec":{"template":{"spec":{"containers":[{"name":"<container>","resources":{"limits":{"ephemeral-storage":"1Gi"}}}]}}}}'
    ```

    ### åœºæ™¯ 2: èŠ‚ç‚¹å†…å­˜å‹åŠ›
    
    **äº‹ä»¶**: `The node was low on resource: memory`
    
    **æ ¹å› **: èŠ‚ç‚¹å†…å­˜ç´§å¼ ï¼Œkubelet é©±é€ä½ä¼˜å…ˆçº§ Pod
    
    **è¯Šæ–­**:
    ```bash
    # æŸ¥çœ‹èŠ‚ç‚¹å†…å­˜æƒ…å†µ
    kubectl describe node <node-name> | grep -A 5 "Allocated resources"
    ```
    
    **ä¿®å¤**:
    - è®¾ç½®åˆç†çš„ requests/limits
    - æ‰©å®¹èŠ‚ç‚¹
    - è®¾ç½® PriorityClass ä¿æŠ¤é‡è¦ Pod

    ### åœºæ™¯ 3: èŠ‚ç‚¹ç£ç›˜å‹åŠ›
    
    **äº‹ä»¶**: `The node was low on resource: ephemeral-storage`
    
    **æ ¹å› **: èŠ‚ç‚¹ç£ç›˜ç©ºé—´ä¸è¶³
    
    **ä¿®å¤**:
    - æ¸…ç†èŠ‚ç‚¹ç£ç›˜ï¼ˆå‚è€ƒ disk-full æ‰‹å†Œï¼‰
    - ä½¿ç”¨ PVC å­˜å‚¨å¤§æ–‡ä»¶

    ## ğŸ”§ ä¿®å¤å‘½ä»¤

    ```bash
    # æ¸…ç†æ‰€æœ‰ Evicted Pod
    kubectl get pod -A | grep Evicted | awk '{print $2 " -n " $1}' | xargs -L1 kubectl delete pod
    
    # æŸ¥çœ‹èŠ‚ç‚¹èµ„æºåˆ†é…æƒ…å†µ
    kubectl describe nodes | grep -A 20 "Allocated resources"
    ```

    ## é¢„é˜²æªæ–½
    
    - è®¾ç½®åˆç†çš„ requests/limits
    - ä½¿ç”¨ PVC å­˜å‚¨å¤§æ–‡ä»¶ï¼Œä¸è¦å†™å…¥å®¹å™¨å±‚
    - é…ç½® PodDisruptionBudget ä¿æŠ¤å…³é”®æœåŠ¡
    - è®¾ç½®èŠ‚ç‚¹èµ„æºå‘Šè­¦

  # ==========================================================================
  # Helm ç®¡ç† Observability å¯è§‚æµ‹æ€§å¹³å°
  # ==========================================================================
  helm-observability-install.md: |
    # Helm ç®¡ç† Observability å¹³å°

    > **ç±»å‹**: `procedure`ï¼ˆæµç¨‹å‹ï¼‰
    > **åŒ…å«æ“ä½œ**: å®‰è£… | å‡çº§ | å¸è½½
    > **âš ï¸ æ ¹æ®ç”¨æˆ·æ„å›¾é€‰æ‹©å¯¹åº”æµç¨‹ï¼Œä¸è¦ä»å¤´æ‰§è¡Œï¼**

    ## â›” çº¦æŸ
    **ç¦æ­¢ä½¿ç”¨ `run_bash_command` æ‰§è¡Œ helm å‘½ä»¤ï¼Œå¿…é¡»ä½¿ç”¨ MCP å·¥å…·ï¼**

    ## ğŸ” å›ºå®šé…ç½®ï¼ˆç§æœ‰ Repoï¼‰
    | å‚æ•° | å€¼ |
    |------|-----|
    | repo_name | `observability` |
    | url | `http://192.168.1.63/api/v4/projects/65/packages/helm/stable` |
    | username | `wanghuhu` |
    | password | `glpat-n_ZsxoVt4HxN_ExHENy3` |
    | chart | `observability/observability` |

    ## ğŸ”„ åŠ¨æ€å‚æ•°ï¼ˆæ ¹æ®ç”¨æˆ·è¾“å…¥å†³å®šï¼‰
    | å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
    |------|--------|------|
    | release_name | `observability` | ç”¨æˆ·å¯æŒ‡å®šå…¶ä»–åç§° |
    | namespace | `xnet` | ç”¨æˆ·å¯æŒ‡å®šå…¶ä»–å‘½åç©ºé—´ |

    ---
    ---

    ## ğŸ“¦ æ“ä½œï¼šå®‰è£…ï¼ˆå½“ç”¨æˆ·è¯´"å®‰è£…"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **Step 1**: æ·»åŠ  Repo
    ```
    å·¥å…·: helm_repo_add
    å‚æ•°: name=observability, url=<å›ºå®šURL>, username=<å›ºå®š>, password=<å›ºå®š>
    ```

    **Step 2**: å®‰è£… Chart
    ```
    å·¥å…·: helm_install
    å‚æ•°: release_name=<åŠ¨æ€>, chart=observability/observability, namespace=<åŠ¨æ€>, create_namespace=true, wait=true
    ```

    ---
    ---

    ## ğŸ”„ æ“ä½œï¼šå‡çº§ï¼ˆå½“ç”¨æˆ·è¯´"å‡çº§/æ›´æ–°"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **Step 1**: æ›´æ–° Repo ç´¢å¼•
    ```
    å·¥å…·: helm_repo_update
    ```

    **Step 2**: å‡çº§ Release
    ```
    å·¥å…·: helm_upgrade
    å‚æ•°: release_name=<åŠ¨æ€>, chart=observability/observability, namespace=<åŠ¨æ€>, wait=true
    ```

    ---
    ---

    ## ğŸ—‘ï¸ æ“ä½œï¼šå¸è½½ï¼ˆå½“ç”¨æˆ·è¯´"å¸è½½/åˆ é™¤/ç§»é™¤"æ—¶æ‰§è¡Œæ­¤æµç¨‹ï¼‰

    **ä»…éœ€ 1 æ­¥**:
    ```
    å·¥å…·: helm_uninstall
    å‚æ•°: release_name=<åŠ¨æ€>, namespace=<åŠ¨æ€>
    ```

    ---
    ---

    ## âš ï¸ æ•…éšœæ’æŸ¥
    - ç½‘ç»œé—®é¢˜: æ£€æŸ¥ `192.168.1.63` æ˜¯å¦å¯è¾¾
    - éªŒè¯çŠ¶æ€: `kubectl get pods -n <namespace>`
